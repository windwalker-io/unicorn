{"version":3,"file":"field-single-image-drag.js","sources":["../../src/module/field-single-image-drag.ts"],"sourcesContent":["\r\nimport { useHttpClient } from '../composable';\r\nimport { __, injectCssToDocument, selectAll, simpleAlert } from '../service';\r\nimport { mergeDeep } from '../utilities';\r\nimport css from '../../scss/field/single-image-drag.scss?inline';\r\nimport { Modal } from 'bootstrap';\r\nimport type Cropper from 'cropperjs';\r\nimport { ApiReturn } from './http-client';\r\n\r\ninjectCssToDocument(css);\r\n\r\nexport interface SingleImageDragOptions {\r\n  accept: string | string[];\r\n  ajax_url?: string;\r\n  crop: boolean;\r\n  width: number;\r\n  height: number;\r\n  max_width?: number;\r\n  min_width?: number;\r\n  max_height?: number;\r\n  min_height?: number;\r\n  modalTarget: string;\r\n}\r\n\r\nconst defaultOptions: Partial<SingleImageDragOptions> = {\r\n  accept: [\r\n    'image/jpeg',\r\n    'image/png',\r\n    'image/webp',\r\n    'image/avif',\r\n    'image/gif',\r\n  ],\r\n  crop: false,\r\n  width: 800,\r\n  height: 800,\r\n};\r\n\r\nexport class SingleImageDragElement extends HTMLElement {\r\n  static is = 'uni-sid';\r\n\r\n  currentImage = '';\r\n  currentFile: File | undefined = undefined;\r\n  lastZoom = 0;\r\n  valueBackup = '';\r\n\r\n  private options!: SingleImageDragOptions;\r\n  private valueInput!: HTMLInputElement;\r\n  private fileInput!: HTMLInputElement;\r\n  private selectButton!: HTMLButtonElement;\r\n  private pasteButton!: HTMLButtonElement;\r\n  private dragarea!: HTMLDivElement;\r\n  private previewImage!: HTMLImageElement;\r\n  private removeCheckbox!: HTMLInputElement;\r\n  private modalElement!: HTMLDivElement;\r\n  private modal!: Modal;\r\n  private cropContainer!: HTMLDivElement;\r\n  private savebutton!: HTMLButtonElement;\r\n  private modalToolbarButtons!: NodeListOf<HTMLButtonElement>;\r\n  private cropper!: Cropper;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.options = mergeDeep(\r\n      {},\r\n      defaultOptions,\r\n      JSON.parse(this.getAttribute('options') || '{}')\r\n    );\r\n\r\n    this.valueInput = this.querySelector<HTMLInputElement>('[data-field-input]')!;\r\n    this.fileInput = this.querySelector<HTMLInputElement>('[data-sid=file]')!;\r\n    this.selectButton = this.querySelector<HTMLButtonElement>('[data-sid=select]')!;\r\n    this.pasteButton = this.querySelector<HTMLButtonElement>('[data-sid=paste]')!;\r\n    this.dragarea = this.querySelector<HTMLDivElement>('[data-sid=dragarea]')!;\r\n    this.previewImage = this.querySelector<HTMLImageElement>('[data-sid=preview]')!;\r\n    this.removeCheckbox = this.querySelector<HTMLInputElement>('[data-sid=remove]')!;\r\n\r\n    this.modalElement = document.querySelector<HTMLDivElement>(this.options.modalTarget)!;\r\n    this.modal = Modal.getOrCreateInstance(this.modalElement);\r\n    this.cropContainer = this.modalElement.querySelector<HTMLDivElement>('[data-sid=\"crop-container\"]')!;\r\n    this.savebutton = this.modalElement.querySelector<HTMLButtonElement>('[data-sid=save-button]')!;\r\n    this.modalToolbarButtons = this.modalElement.querySelectorAll<HTMLButtonElement>('[data-sid-toolbar]');\r\n\r\n    const modalShown = async () => {\r\n      const cropper = await this.getCropper();\r\n      cropper.replace(this.currentImage);\r\n      this.cropContainer.style.visibility = '';\r\n      this.currentImage = '';\r\n    };\r\n\r\n    this.modalElement.addEventListener('shown.bs.modal', modalShown.bind(this));\r\n\r\n    this.savebutton.addEventListener('click', () => {\r\n      this.saveCropped();\r\n      this.modal.hide();\r\n    });\r\n\r\n    this.bindEvents();\r\n\r\n    this.style.visibility = '';\r\n  }\r\n\r\n  bindEvents() {\r\n    this.dragarea.addEventListener('dragover', (event) => {\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n\r\n      this.dragarea.classList.add('hover');\r\n    });\r\n\r\n    this.dragarea.addEventListener('dragleave', (event) => {\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n\r\n      this.dragarea.classList.remove('hover');\r\n    });\r\n\r\n    this.dragarea.addEventListener('drop', (event) => {\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n\r\n      this.dragarea.classList.remove('hover');\r\n\r\n      const files = (event.target as HTMLInputElement).files || event.dataTransfer?.files || [];\r\n      this.handleFileSelect(files[0]);\r\n    });\r\n\r\n    // Select button\r\n    this.selectButton.addEventListener('click', () => {\r\n      const input = document.createElement('input');\r\n      input.setAttribute('type', 'file');\r\n      input.setAttribute('accept', this.getInputAccept());\r\n      input.style.display = 'none';\r\n      input.addEventListener('change', (e) => {\r\n        this.handleFileSelect(input.files![0]!);\r\n\r\n        input.remove();\r\n      });\r\n\r\n      document.body.appendChild(input);\r\n      input.click();\r\n    });\r\n\r\n    this.pasteButton.addEventListener('click', () => {\r\n      navigator.clipboard.read().then((items) => {\r\n        let types = items[0].types;\r\n\r\n        if (types.length === 0) {\r\n          this.alert('This browser unable to get clipboard data.');\r\n          return;\r\n        }\r\n\r\n        types = types.slice().sort();\r\n\r\n        const type = types[0];\r\n\r\n        items[0].getType(type).then((blob) => {\r\n          this.handleFileSelect(new File([ blob ], 'image.png', { type }));\r\n        });\r\n      });\r\n    });\r\n\r\n    // Delete\r\n    this.removeCheckbox?.addEventListener('click', () => {\r\n      if (this.removeCheckbox.checked) {\r\n        this.valueBackup = this.valueInput.value;\r\n        this.valueInput.value = '';\r\n      } else {\r\n        this.valueInput.value = this.valueBackup;\r\n        this.valueBackup = '';\r\n      }\r\n    });\r\n\r\n    // Zoom slider\r\n    selectAll(this.modalToolbarButtons, (button) => {\r\n      button.addEventListener('click', (event) => {\r\n        this.toolbarClicked(button, event);\r\n      });\r\n    });\r\n  }\r\n\r\n  getInputAccept() {\r\n    let accept = this.options.accept;\r\n\r\n    if (Array.isArray(accept)) {\r\n      accept = accept.join(',');\r\n    }\r\n\r\n    return accept;\r\n  }\r\n\r\n  handleFileSelect(file: File) {\r\n    if (!this.checkFile(file)) {\r\n      return;\r\n    }\r\n\r\n    if (this.options.crop) {\r\n      const reader = new FileReader();\r\n\r\n      reader.addEventListener('load', (event) => {\r\n        this.cropContainer.style.visibility = 'hidden';\r\n        this.currentImage = event.target!.result as string;\r\n        this.currentFile = file;\r\n\r\n        // After modal shown, cropper will auto load.\r\n        this.modal.show();\r\n      });\r\n\r\n      reader.readAsDataURL(file);\r\n      return;\r\n    }\r\n\r\n    this.saveImage(file);\r\n  }\r\n\r\n  async saveCropped() {\r\n    const Cropper = await this.getCropper();\r\n\r\n    Cropper.getCroppedCanvas({\r\n        width: this.options.width,\r\n        height: this.options.height,\r\n        imageSmoothingEnabled: true\r\n      })\r\n      .toBlob((blob) => {\r\n        const file = new File([ blob! ], this.currentFile!.name, { type: 'image/png' });\r\n        this.saveImage(file);\r\n      }, 'image/png');\r\n  }\r\n\r\n  async getCropper() {\r\n    if (this.cropper) {\r\n      return this.cropper;\r\n    }\r\n\r\n    const Cropper = await loadCropper();\r\n\r\n    return this.cropper = new Cropper(this.cropContainer.querySelector('img')!, {\r\n      aspectRatio: this.options.width / this.options.height,\r\n      autoCropArea: 1,\r\n      viewMode: 1,\r\n      dragMode: 'move',\r\n      cropBoxMovable: false,\r\n      cropBoxResizable: false,\r\n      ready: (e) => {\r\n        //\r\n      },\r\n    });\r\n  }\r\n\r\n  async toolbarClicked(button: HTMLButtonElement, event: MouseEvent) {\r\n    const cropper = await this.getCropper();\r\n\r\n    const data = cropper.getData();\r\n\r\n    switch (button.dataset.sidToolbar) {\r\n      case 'zoom-in':\r\n        cropper.zoom(0.1);\r\n        break;\r\n\r\n      case 'zoom-out':\r\n        cropper.zoom(-0.1);\r\n        break;\r\n\r\n      case 'rotate-left':\r\n        cropper.rotate(-90);\r\n        break;\r\n\r\n      case 'rotate-right':\r\n        cropper.rotate(90);\r\n        break;\r\n\r\n      case 'scale-x':\r\n        cropper.scaleX(-data.scaleX);\r\n        break;\r\n\r\n      case 'scale-y':\r\n        cropper.scaleY(-data.scaleY);\r\n        break;\r\n    }\r\n  }\r\n\r\n  checkFile(file: File): boolean {\r\n    let accept = this.options.accept;\r\n\r\n    if (typeof accept === 'string') {\r\n      accept = accept.split(',').map(v => v.trim());\r\n    }\r\n\r\n    if (!accept.length) {\r\n      return true;\r\n    }\r\n\r\n    let allow = false;\r\n\r\n    for (const type of accept) {\r\n      if (type.indexOf('/') !== -1) {\r\n        allow = allow || this.compareMimeType(type, file.type);\r\n      } else {\r\n        allow = allow || type.toLowerCase() === getFileExtension(file)?.toLowerCase();\r\n      }\r\n    }\r\n\r\n    if (allow) {\r\n      return true;\r\n    }\r\n\r\n    this.alert(\r\n      __('unicorn.field.sid.message.invalid.image.title'),\r\n      __('unicorn.field.sid.message.invalid.image.desc'),\r\n      'error'\r\n    );\r\n\r\n    return false;\r\n  }\r\n\r\n  compareMimeType(accept: string, mime: string) {\r\n    const accept2 = accept.split('/');\r\n    const mime2 = mime.split('/');\r\n\r\n    if (accept2[1] === '*') {\r\n      return accept2[0] === mime2[0];\r\n    }\r\n\r\n    return accept === mime;\r\n  }\r\n\r\n  checkSize(image: HTMLImageElement): boolean {\r\n    try {\r\n      if (this.options.max_width && this.options.max_width < image.width) {\r\n        throw new Error(__('unicorn.field.sid.message.invalid.size.max.width', this.options.max_width));\r\n      }\r\n\r\n      if (this.options.min_width && this.options.min_width > image.width) {\r\n        throw new Error(__('unicorn.field.sid.message.invalid.size.min.width', this.options.min_width));\r\n      }\r\n\r\n      if (this.options.max_height && this.options.max_height < image.height) {\r\n        throw new Error(__('unicorn.field.sid.message.invalid.size.max.height', this.options.max_height));\r\n      }\r\n\r\n      if (this.options.min_height && this.options.min_height > image.height) {\r\n        throw new Error(__('unicorn.field.sid.message.invalid.size.min.height', this.options.min_height));\r\n      }\r\n    } catch (e) {\r\n      this.alert(\r\n        __('unicorn.field.sid.message.invalid.size.title'),\r\n        (e as Error).message,\r\n        'error'\r\n      );\r\n\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  alert(title: string, text = '', type = 'info') {\r\n    return simpleAlert(title, text, type);\r\n  }\r\n\r\n  async saveImage(file: File) {\r\n    if (this.options.ajax_url) {\r\n      const loading = this.querySelector<HTMLImageElement>('[data-sid=file-uploading]')!;\r\n\r\n      this.previewImage.src = '';\r\n      this.previewImage.style.display = 'none';\r\n      loading.style.display = 'flex';\r\n\r\n      try {\r\n        const res = await this.uploadImage(file);\r\n\r\n        this.storeValue(res.data.data.url, res.data.data.url);\r\n      } catch (e) {\r\n        console.error(e);\r\n        simpleAlert((e as Error).message);\r\n        return;\r\n      } finally {\r\n        loading.style.display = 'none';\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // @see https://stackoverflow.com/a/47172409\r\n    // @see https://stackoverflow.com/a/47522812\r\n    const dt = new DataTransfer();\r\n    dt.items.add(file);\r\n\r\n    // No required for value input to remove validation message\r\n    this.valueInput.required = false;\r\n\r\n    this.fileInput.files = dt.files;\r\n    this.fileInput.dispatchEvent(new CustomEvent('change', { bubbles: true }));\r\n    this.fileInput.dispatchEvent(new CustomEvent('input', { bubbles: true }));\r\n\r\n    this.storeValue('', URL.createObjectURL(file));\r\n  }\r\n\r\n  async uploadImage(file: File) {\r\n    const formData = new FormData();\r\n    formData.append('file', file);\r\n\r\n    const { post } = await useHttpClient();\r\n\r\n    return post<ApiReturn<{ url: string; }>>(this.options.ajax_url!, formData, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data'\r\n      }\r\n    });\r\n  }\r\n\r\n  storeValue(url: string, preview: string) {\r\n    this.previewImage.src = preview;\r\n    this.previewImage.style.display = 'inline-block';\r\n\r\n    // Make delete box unchecked\r\n    if (this.removeCheckbox) {\r\n      this.removeCheckbox.checked = false;\r\n    }\r\n\r\n    if (url) {\r\n      this.valueInput.value = url;\r\n    }\r\n\r\n    // Trigger change\r\n    this.previewImage.dispatchEvent(new CustomEvent('change', { bubbles: true }));\r\n    this.valueInput.dispatchEvent(new CustomEvent('change', { bubbles: true }));\r\n    this.valueInput.dispatchEvent(new CustomEvent('input', { bubbles: true }));\r\n  }\r\n}\r\n\r\n// Promise.all([\r\n//   import('@cropperjs/cropper.min.js'),\r\n//   import('@cropperjs/cropper.css'),\r\n// ])\r\n//   .then((service) => {\r\n//     const styleSheet = service[1].default;\r\n//     document.adoptedStyleSheets = [...document.adoptedStyleSheets, styleSheet];\r\n//   });\r\n\r\ncustomElements.define(SingleImageDragElement.is, SingleImageDragElement);\r\n\r\nfunction getFileExtension(file: File): string | undefined {\r\n  const parts = file.name.split('.');\r\n  if (parts.length > 1) {\r\n    return parts.pop();\r\n  }\r\n  return undefined;\r\n}\r\n\r\nasync function loadCropper(): Promise<typeof Cropper> {\r\n  const [module] = await Promise.all([\r\n    import('cropperjs'),\r\n    import('cropperjs/dist/cropper.min.css?inline').then(({ default: css }) => {\r\n      injectCssToDocument(css);\r\n    })\r\n  ]);\r\n\r\n  return module.default;\r\n}\r\n\r\nloadCropper();\r\n\r\nexport interface SingleImageDragModule {\r\n  SingleImageDragElement: typeof SingleImageDragElement;\r\n}\r\n"],"names":["css"],"mappings":"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"}