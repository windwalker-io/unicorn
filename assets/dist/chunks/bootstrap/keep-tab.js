import { Tab } from "bootstrap";
import { s as sleep } from "../composable/useQueue.js";
import { u as useUniDirective } from "../composable/useUniDirective.js";
import { m as module, s as selectOne, a as selectAll } from "../service/dom.js";
import { m as mergeDeep } from "../utilities/arr.js";
const defaultOptions = {
  tabItemSelector: "[data-toggle=tab],[data-bs-toggle=tab],[data-toggle=pill],[data-bs-toggle=pill]",
  delay: 0
};
class KeepTab {
  $element;
  tabButtons;
  storageKey = "";
  options;
  constructor(selector, options = {}) {
    options = mergeDeep({}, defaultOptions, options);
    let uid;
    if (typeof selector === "object") {
      uid = options.uid || selector.id;
    } else {
      uid = selector;
    }
    const $element = this.$element = selectOne(selector);
    if (!$element) {
      console.warn(`[KeepTab] Element ${selector} not found.`);
      return;
    }
    this.options = options;
    this.$element = $element;
    this.tabButtons = $element.querySelectorAll(this.options.tabItemSelector);
    this.init(uid);
  }
  async init(uid) {
    this.storageKey = "tab-href-" + await this.hashCode(location.href + ":" + uid);
    this.bindEvents();
    await sleep(this.options.delay || 0);
    this.switchTab();
  }
  bindEvents() {
    [].forEach.call(this.tabButtons, (button) => {
      button.addEventListener("click", () => {
        window.localStorage.setItem(this.storageKey, this.getButtonHref(button));
      });
    });
  }
  getButtonHref(button) {
    return button.dataset.bsTarget || button.dataset.target || button.href;
  }
  findTabButtonByHref(href) {
    return selectAll(this.options.tabItemSelector).filter((button) => {
      if (button.href === href) {
        return true;
      }
      if (button.dataset.bsTarget === href) {
        return true;
      }
      return button.dataset.target === href;
    }).shift();
  }
  activateTab(href) {
    const tabTrigger = this.findTabButtonByHref(href);
    if (tabTrigger) {
      Tab.getOrCreateInstance(tabTrigger).show();
    }
  }
  hasTab(href) {
    return this.findTabButtonByHref(href) != null;
  }
  /**
   * Switch tab.
   *
   * @returns {boolean}
   */
  switchTab() {
    if (localStorage.getItem(this.storageKey)) {
      if (!this.hasTab(localStorage.getItem(this.storageKey) || "")) {
        localStorage.removeItem(this.storageKey);
        return true;
      }
      const tabhref = localStorage.getItem(this.storageKey) || "";
      this.activateTab(tabhref);
    }
  }
  /**
   * Hash code.
   */
  async hashCode(text) {
    const msgBuffer = new TextEncoder().encode(text);
    const hashBuffer = await globalThis.crypto.subtle.digest("SHA-256", msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
  }
}
const ready = /* @__PURE__ */ useUniDirective("keeptab", {
  mounted(el, { value }) {
    const options = JSON.parse(value || "{}");
    module(el, "uni.keeptab", () => new KeepTab(el, options));
  }
});
export {
  KeepTab,
  ready
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2VlcC10YWIuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ib290c3RyYXAva2VlcC10YWIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlVW5pRGlyZWN0aXZlIH0gZnJvbSAnLi4vY29tcG9zYWJsZSc7XHJcbmltcG9ydCB7IG1vZHVsZSwgc2VsZWN0QWxsLCBzZWxlY3RPbmUsIHNsZWVwIH0gZnJvbSAnLi4vc2VydmljZSc7XHJcbmltcG9ydCB7IFRhYiB9IGZyb20gJ2Jvb3RzdHJhcCc7XHJcbmltcG9ydCB7IG1lcmdlRGVlcCB9IGZyb20gJy4uL3V0aWxpdGllcyc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEtlZXBUYWJPcHRpb25zIHtcclxuICB1aWQ/OiBzdHJpbmc7XHJcbiAgZGVsYXk/OiBudW1iZXI7XHJcbiAgdGFiSXRlbVNlbGVjdG9yPzogc3RyaW5nO1xyXG59XHJcblxyXG5jb25zdCBkZWZhdWx0T3B0aW9ucyA9IHtcclxuICB0YWJJdGVtU2VsZWN0b3I6ICdbZGF0YS10b2dnbGU9dGFiXSxbZGF0YS1icy10b2dnbGU9dGFiXSxbZGF0YS10b2dnbGU9cGlsbF0sW2RhdGEtYnMtdG9nZ2xlPXBpbGxdJyxcclxuICBkZWxheTogMCxcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBLZWVwVGFiIHtcclxuICAkZWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcbiAgdGFiQnV0dG9ucyE6IE5vZGVMaXN0T2Y8SFRNTEVsZW1lbnQ+O1xyXG4gIHN0b3JhZ2VLZXk6IHN0cmluZyA9ICcnO1xyXG4gIG9wdGlvbnM6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3Ioc2VsZWN0b3I6IEhUTUxFbGVtZW50IHwgc3RyaW5nLCBvcHRpb25zOiBLZWVwVGFiT3B0aW9ucyA9IHt9KSB7XHJcbiAgICBvcHRpb25zID0gbWVyZ2VEZWVwKHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XHJcbiAgICBsZXQgdWlkOiBzdHJpbmc7XHJcblxyXG4gICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgdWlkID0gb3B0aW9ucy51aWQgfHwgc2VsZWN0b3IuaWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB1aWQgPSBzZWxlY3RvcjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCAkZWxlbWVudCA9IHRoaXMuJGVsZW1lbnQgPSBzZWxlY3RPbmU8SFRNTEVsZW1lbnQ+KHNlbGVjdG9yKSE7XHJcblxyXG4gICAgaWYgKCEkZWxlbWVudCkge1xyXG4gICAgICBjb25zb2xlLndhcm4oYFtLZWVwVGFiXSBFbGVtZW50ICR7c2VsZWN0b3J9IG5vdCBmb3VuZC5gKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XHJcblxyXG4gICAgdGhpcy4kZWxlbWVudCA9ICRlbGVtZW50O1xyXG4gICAgdGhpcy50YWJCdXR0b25zID0gJGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLm9wdGlvbnMudGFiSXRlbVNlbGVjdG9yKTtcclxuXHJcbiAgICB0aGlzLmluaXQodWlkKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBhc3luYyBpbml0KHVpZDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLnN0b3JhZ2VLZXkgPSAndGFiLWhyZWYtJyArIGF3YWl0IHRoaXMuaGFzaENvZGUobG9jYXRpb24uaHJlZiArICc6JyArIHVpZCk7XHJcblxyXG4gICAgdGhpcy5iaW5kRXZlbnRzKCk7XHJcblxyXG4gICAgYXdhaXQgc2xlZXAodGhpcy5vcHRpb25zLmRlbGF5IHx8IDApO1xyXG5cclxuICAgIHRoaXMuc3dpdGNoVGFiKCk7XHJcbiAgfVxyXG5cclxuICBiaW5kRXZlbnRzKCkge1xyXG4gICAgW10uZm9yRWFjaC5jYWxsKHRoaXMudGFiQnV0dG9ucywgKGJ1dHRvbjogSFRNTEFuY2hvckVsZW1lbnQpID0+IHtcclxuICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgIC8vIFN0b3JlIHRoZSBzZWxlY3RlZCB0YWIgaHJlZiBpbiBsb2NhbHN0b3JhZ2VcclxuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5zdG9yYWdlS2V5LCB0aGlzLmdldEJ1dHRvbkhyZWYoYnV0dG9uKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRCdXR0b25IcmVmKGJ1dHRvbjogSFRNTEFuY2hvckVsZW1lbnQpIHtcclxuICAgIHJldHVybiBidXR0b24uZGF0YXNldC5ic1RhcmdldCB8fCBidXR0b24uZGF0YXNldC50YXJnZXQgfHwgYnV0dG9uLmhyZWY7XHJcbiAgfVxyXG5cclxuICBmaW5kVGFiQnV0dG9uQnlIcmVmKGhyZWY6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHNlbGVjdEFsbDxIVE1MQW5jaG9yRWxlbWVudD4odGhpcy5vcHRpb25zLnRhYkl0ZW1TZWxlY3RvcilcclxuICAgICAgLmZpbHRlcigoYnV0dG9uOiBIVE1MQW5jaG9yRWxlbWVudCkgPT4ge1xyXG4gICAgICAgIGlmIChidXR0b24uaHJlZiA9PT0gaHJlZikge1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoYnV0dG9uLmRhdGFzZXQuYnNUYXJnZXQgPT09IGhyZWYpIHtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGJ1dHRvbi5kYXRhc2V0LnRhcmdldCA9PT0gaHJlZjtcclxuICAgICAgfSlcclxuICAgICAgLnNoaWZ0KCk7XHJcbiAgfVxyXG5cclxuICBhY3RpdmF0ZVRhYihocmVmOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHRhYlRyaWdnZXIgPSB0aGlzLmZpbmRUYWJCdXR0b25CeUhyZWYoaHJlZik7XHJcblxyXG4gICAgaWYgKHRhYlRyaWdnZXIpIHtcclxuICAgICAgVGFiLmdldE9yQ3JlYXRlSW5zdGFuY2UodGFiVHJpZ2dlcikuc2hvdygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGFzVGFiKGhyZWY6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMuZmluZFRhYkJ1dHRvbkJ5SHJlZihocmVmKSAhPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3dpdGNoIHRhYi5cclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAqL1xyXG4gIHN3aXRjaFRhYigpIHtcclxuICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLnN0b3JhZ2VLZXkpKSB7XHJcbiAgICAgIC8vIFdoZW4gbW92aW5nIGZyb20gdGFiIGFyZWEgdG8gYSBkaWZmZXJlbnQgdmlld1xyXG4gICAgICBpZiAoIXRoaXMuaGFzVGFiKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuc3RvcmFnZUtleSkgfHwgJycpKSB7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5zdG9yYWdlS2V5KTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ2xlYW4gZGVmYXVsdCB0YWJzXHJcbiAgICAgIC8vIHNlbGVjdE9uZSh0aGlzLiRlbGVtZW50LCAnW2RhdGEtdG9nZ2xlPVwidGFiXCJdLCBbZGF0YS1icy10b2dnbGU9dGFiXScpXHJcbiAgICAgIC8vIHRoaXMuJGVsZW1lbnQucXVlcnlTZWxlY3RvcignYVtkYXRhLXRvZ2dsZT1cInRhYlwiXScpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuXHJcbiAgICAgIGNvbnN0IHRhYmhyZWYgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLnN0b3JhZ2VLZXkpIHx8ICcnO1xyXG5cclxuICAgICAgLy8gQWRkIGFjdGl2ZSBhdHRyaWJ1dGUgZm9yIHNlbGVjdGVkIHRhYiBpbmRpY2F0ZWQgYnkgdXJsXHJcbiAgICAgIHRoaXMuYWN0aXZhdGVUYWIodGFiaHJlZik7XHJcblxyXG4gICAgICAvLyBDaGVjayB3aGV0aGVyIGludGVybmFsIHRhYiBpcyBzZWxlY3RlZCAoaW4gZm9ybWF0IDx0YWJuYW1lPi08aWQ+KVxyXG4gICAgICAvLyBjb25zdCBzZXBlcmF0b3JJbmRleCA9IHRhYmhyZWYuaW5kZXhPZignLScpO1xyXG4gICAgICAvL1xyXG4gICAgICAvLyBpZiAoc2VwZXJhdG9ySW5kZXggIT09IC0xKSB7XHJcbiAgICAgIC8vICAgY29uc3Qgc2luZ3VsYXIgPSB0YWJocmVmLnN1YnN0cmluZygwLCBzZXBlcmF0b3JJbmRleCk7XHJcbiAgICAgIC8vICAgY29uc3QgcGx1cmFsID0gc2luZ3VsYXIgKyAncyc7XHJcbiAgICAgIC8vXHJcbiAgICAgIC8vICAgdGhpcy5hY3RpdmF0ZVRhYihwbHVyYWwpO1xyXG4gICAgICAvLyB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBIYXNoIGNvZGUuXHJcbiAgICovXHJcbiAgYXN5bmMgaGFzaENvZGUodGV4dDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIGNvbnN0IG1zZ0J1ZmZlciA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSh0ZXh0KTtcclxuICAgIGNvbnN0IGhhc2hCdWZmZXIgPSBhd2FpdCBnbG9iYWxUaGlzLmNyeXB0by5zdWJ0bGUuZGlnZXN0KFwiU0hBLTI1NlwiLCBtc2dCdWZmZXIpO1xyXG4gICAgY29uc3QgaGFzaEFycmF5ID0gQXJyYXkuZnJvbShuZXcgVWludDhBcnJheShoYXNoQnVmZmVyKSk7XHJcbiAgICByZXR1cm4gaGFzaEFycmF5Lm1hcChiID0+IGIudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIFwiMFwiKSkuam9pbihcIlwiKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCByZWFkeSA9IHVzZVVuaURpcmVjdGl2ZSgna2VlcHRhYicsIHtcclxuICBtb3VudGVkKGVsLCB7IHZhbHVlIH0pIHtcclxuICAgIGNvbnN0IG9wdGlvbnM6IEtlZXBUYWJPcHRpb25zID0gSlNPTi5wYXJzZSh2YWx1ZSB8fCAne30nKTtcclxuXHJcbiAgICBtb2R1bGUoZWwsICd1bmkua2VlcHRhYicsICgpID0+IG5ldyBLZWVwVGFiKGVsLCBvcHRpb25zKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgS2VlcFRhYk1vZHVsZSB7XHJcbiAgS2VlcFRhYjogdHlwZW9mIEtlZXBUYWI7XHJcbiAgcmVhZHk6IHR5cGVvZiByZWFkeTtcclxufVxyXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFXQSxNQUFNLGlCQUFpQjtBQUFBLEVBQ3JCLGlCQUFpQjtBQUFBLEVBQ2pCLE9BQU87QUFDVDtBQUVPLE1BQU0sUUFBUTtBQUFBLEVBQ25CO0FBQUEsRUFDQTtBQUFBLEVBQ0EsYUFBcUI7QUFBQSxFQUNyQjtBQUFBLEVBRUEsWUFBWSxVQUFnQyxVQUEwQixJQUFJO0FBQ3hFLGNBQVUsVUFBVSxJQUFJLGdCQUFnQixPQUFPO0FBQy9DLFFBQUk7QUFFSixRQUFJLE9BQU8sYUFBYSxVQUFVO0FBQ2hDLFlBQU0sUUFBUSxPQUFPLFNBQVM7QUFBQSxJQUNoQyxPQUFPO0FBQ0wsWUFBTTtBQUFBLElBQ1I7QUFFQSxVQUFNLFdBQVcsS0FBSyxXQUFXLFVBQXVCLFFBQVE7QUFFaEUsUUFBSSxDQUFDLFVBQVU7QUFDYixjQUFRLEtBQUsscUJBQXFCLFFBQVEsYUFBYTtBQUN2RDtBQUFBLElBQ0Y7QUFFQSxTQUFLLFVBQVU7QUFFZixTQUFLLFdBQVc7QUFDaEIsU0FBSyxhQUFhLFNBQVMsaUJBQWlCLEtBQUssUUFBUSxlQUFlO0FBRXhFLFNBQUssS0FBSyxHQUFHO0FBQUEsRUFDZjtBQUFBLEVBRUEsTUFBZ0IsS0FBSyxLQUFhO0FBQ2hDLFNBQUssYUFBYSxjQUFjLE1BQU0sS0FBSyxTQUFTLFNBQVMsT0FBTyxNQUFNLEdBQUc7QUFFN0UsU0FBSyxXQUFBO0FBRUwsVUFBTSxNQUFNLEtBQUssUUFBUSxTQUFTLENBQUM7QUFFbkMsU0FBSyxVQUFBO0FBQUEsRUFDUDtBQUFBLEVBRUEsYUFBYTtBQUNYLEtBQUEsRUFBRyxRQUFRLEtBQUssS0FBSyxZQUFZLENBQUMsV0FBOEI7QUFDOUQsYUFBTyxpQkFBaUIsU0FBUyxNQUFNO0FBRXJDLGVBQU8sYUFBYSxRQUFRLEtBQUssWUFBWSxLQUFLLGNBQWMsTUFBTSxDQUFDO0FBQUEsTUFDekUsQ0FBQztBQUFBLElBQ0gsQ0FBQztBQUFBLEVBQ0g7QUFBQSxFQUVBLGNBQWMsUUFBMkI7QUFDdkMsV0FBTyxPQUFPLFFBQVEsWUFBWSxPQUFPLFFBQVEsVUFBVSxPQUFPO0FBQUEsRUFDcEU7QUFBQSxFQUVBLG9CQUFvQixNQUFjO0FBQ2hDLFdBQU8sVUFBNkIsS0FBSyxRQUFRLGVBQWUsRUFDN0QsT0FBTyxDQUFDLFdBQThCO0FBQ3JDLFVBQUksT0FBTyxTQUFTLE1BQU07QUFDeEIsZUFBTztBQUFBLE1BQ1Q7QUFFQSxVQUFJLE9BQU8sUUFBUSxhQUFhLE1BQU07QUFDcEMsZUFBTztBQUFBLE1BQ1Q7QUFFQSxhQUFPLE9BQU8sUUFBUSxXQUFXO0FBQUEsSUFDbkMsQ0FBQyxFQUNBLE1BQUE7QUFBQSxFQUNMO0FBQUEsRUFFQSxZQUFZLE1BQWM7QUFDeEIsVUFBTSxhQUFhLEtBQUssb0JBQW9CLElBQUk7QUFFaEQsUUFBSSxZQUFZO0FBQ2QsVUFBSSxvQkFBb0IsVUFBVSxFQUFFLEtBQUE7QUFBQSxJQUN0QztBQUFBLEVBQ0Y7QUFBQSxFQUVBLE9BQU8sTUFBYztBQUNuQixXQUFPLEtBQUssb0JBQW9CLElBQUksS0FBSztBQUFBLEVBQzNDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBT0EsWUFBWTtBQUNWLFFBQUksYUFBYSxRQUFRLEtBQUssVUFBVSxHQUFHO0FBRXpDLFVBQUksQ0FBQyxLQUFLLE9BQU8sYUFBYSxRQUFRLEtBQUssVUFBVSxLQUFLLEVBQUUsR0FBRztBQUM3RCxxQkFBYSxXQUFXLEtBQUssVUFBVTtBQUN2QyxlQUFPO0FBQUEsTUFDVDtBQU1BLFlBQU0sVUFBVSxhQUFhLFFBQVEsS0FBSyxVQUFVLEtBQUs7QUFHekQsV0FBSyxZQUFZLE9BQU87QUFBQSxJQVcxQjtBQUFBLEVBQ0Y7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtBLE1BQU0sU0FBUyxNQUErQjtBQUM1QyxVQUFNLFlBQVksSUFBSSxjQUFjLE9BQU8sSUFBSTtBQUMvQyxVQUFNLGFBQWEsTUFBTSxXQUFXLE9BQU8sT0FBTyxPQUFPLFdBQVcsU0FBUztBQUM3RSxVQUFNLFlBQVksTUFBTSxLQUFLLElBQUksV0FBVyxVQUFVLENBQUM7QUFDdkQsV0FBTyxVQUFVLElBQUksQ0FBQSxNQUFLLEVBQUUsU0FBUyxFQUFFLEVBQUUsU0FBUyxHQUFHLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRTtBQUFBLEVBQ3BFO0FBQ0Y7QUFFTyxNQUFNLFFBQVEsZ0NBQWdCLFdBQVc7QUFBQSxFQUM5QyxRQUFRLElBQUksRUFBRSxTQUFTO0FBQ3JCLFVBQU0sVUFBMEIsS0FBSyxNQUFNLFNBQVMsSUFBSTtBQUV4RCxXQUFPLElBQUksZUFBZSxNQUFNLElBQUksUUFBUSxJQUFJLE9BQU8sQ0FBQztBQUFBLEVBQzFEO0FBQ0YsQ0FBQzsifQ==
