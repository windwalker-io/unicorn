{"version":3,"file":"legacy.js","sources":["../../../../../../node_modules/@lyrasoft/ts-toolkit/src/generic/number.ts","../../src/legacy/loader.ts","../../src/legacy/legacy.ts"],"sourcesContent":["export function numberFormat(number: string | number, decimals = 0, decPoint = '.', thousandsSep = ',') {\n  number = Number(number);\n\n  const str = number.toFixed(decimals ? decimals : 0).toString().split('.');\n  const parts = [];\n\n  for (var i = str[0].length; i > 0; i -= 3) {\n    parts.unshift(str[0].substring(Math.max(0, i - 3), i));\n  }\n\n  str[0] = parts.join(thousandsSep ? thousandsSep : ',');\n\n  return str.join(decPoint ? decPoint : '.');\n}\n","import { isDebug } from '../service';\n\nconst imports: Record<string, { promise: Promise<any>; resolve?: Function; }> = {};\n\nexport class LegacyLoader {\n  static install(app: any) {\n    const loader = app.$loader = new this(app);\n\n    app.import = loader.import.bind(loader);\n    app.importSync = loader.importSync.bind(loader);\n    app.importCSS = loader.importCSS.bind(loader);\n    app.minFileName = loader.minFileName.bind(loader);\n    app.afterImported = loader.afterImported.bind(loader);\n  }\n\n  constructor(protected app: any) {\n    //\n  }\n\n  doImport(src: string): Promise<any> {\n    return S.import(src);\n  }\n\n  /**\n   * Import modules or scripts.\n   */\n  import(...src: any[]): Promise<any|any[]> {\n    if (src.length === 1) {\n      return this.doImport(src[0]);\n    }\n\n    const promises: Promise<any>[] = [];\n\n    src.forEach((link) => {\n      promises.push(\n        link instanceof Promise ? link : this.doImport(link)\n      );\n    });\n\n    return Promise.all(promises);\n  }\n\n  /**\n   * Import sync.\n   */\n  importSync(...src: any): Promise<any|any[]> {\n    let promise: Promise<any> = Promise.resolve();\n    let url: string[];\n    const modules: any[] = [];\n\n    while (url = src.shift()) {\n      if (!Array.isArray(url)) {\n        url = [ url ];\n      }\n\n      const target = url;\n      promise = promise.then(\n        () => this.import(...target).then((m) => {\n          modules.push(m);\n          return modules;\n        })\n      );\n    }\n\n    return promise;\n  }\n\n  /**\n   * Import CSS files.\n   */\n  async importCSS(...src: any): Promise<any|any[]> {\n    let modules: any = await this.import(...src);\n\n    if (!Array.isArray(modules)) {\n      modules = [modules];\n    }\n\n    const styles: CSSStyleSheet[] = (modules as any[]).map(module => module.default);\n\n    document.adoptedStyleSheets = [...document.adoptedStyleSheets, ...styles];\n  }\n\n  minFileName(fileName: string): string {\n    const segments = fileName.split('.');\n    const ext = segments.pop();\n\n    if (isDebug()) {\n      return segments.join('.') + '.min.' + ext;\n    }\n\n    return fileName;\n  }\n\n  asImported(name: string) {\n    if (!imports[name]) {\n      imports[name] = {\n        promise: Promise.resolve(),\n        resolve: undefined\n      };\n    } else {\n      imports[name]?.resolve?.();\n    }\n  }\n\n  /**\n   * Add after import hook for some url or id.\n   */\n  afterImported(name: string, callback: (resolve: Function, reject?: Function) => void): Promise<any> {\n    if (!imports[name]) {\n      let r;\n      imports[name] = {\n        promise: new Promise((resolve) => {\n          r = resolve;\n        }),\n      };\n\n      imports[name].resolve = r;\n    }\n\n    imports[name].promise.then(callback);\n\n    return imports[name].promise;\n  }\n}\n\n","import { numberFormat } from '@lyrasoft/ts-toolkit/generic';\nimport { sprintf, vsprintf } from 'sprintf-js';\nimport {\n  addGlobalValidator,\n  useBs5Tooltip,\n  useCheckboxesMultiSelect,\n  useFieldValidationSync,\n  useForm,\n  useFormAsync,\n  useFormValidation,\n  useFormValidationSync,\n  useGrid,\n  useGridAsync,\n  useHttpClient,\n  useQueue,\n  useStack,\n  useTomSelect,\n  useUniDirective\n} from '../composable';\nimport {\n  __,\n  animateTo,\n  base64UrlDecode,\n  base64UrlEncode,\n  clearMessages,\n  clearNotifies,\n  debounce,\n  delegate,\n  domready,\n  fadeIn,\n  fadeOut,\n  getBoundedInstance,\n  getBoundedInstanceList,\n  h,\n  highlight,\n  html,\n  initAlpineComponent,\n  isDebug,\n  loadAlpine,\n  mark,\n  module,\n  notify,\n  prepareAlpine,\n  renderMessage,\n  route,\n  selectAll,\n  selectOne,\n  serial,\n  simpleAlert,\n  simpleConfirm,\n  slideDown,\n  slideToggle,\n  slideUp,\n  throttle,\n  tid,\n  uid,\n  useAssetUri,\n  useColorPicker,\n  useDisableIfStackNotEmpty,\n  useDisableOnSubmit,\n  useKeepAlive,\n  useSystemUri\n} from '../service';\nimport { LegacyLoader } from './loader';\n\nexport async function useLegacyMethods(app: any) {\n  const http = await useHttpClient();\n\n  app.use(LegacyLoader);\n\n  handleUri(app);\n  handlerHelper(app);\n  handleCrypto(app);\n\n  app.__ = __;\n  app.trans = __;\n  app.route = route;\n  app.$http = http;\n  app.directive = useUniDirective;\n\n  app.animate = animateTo;\n  app.$animation = { to: animateTo };\n\n  app.addMessage = renderMessage;\n  app.clearMessages = clearMessages;\n  app.notify = notify;\n  app.clearNotifies = clearNotifies;\n\n  app.loadAlpine = loadAlpine;\n  app.initAlpine = initAlpineComponent;\n  app.beforeAlpineInit = prepareAlpine;\n  app.prepareAlpine = prepareAlpine;\n\n  handleUI(app);\n\n  await handleFormGrid(app);\n\n  app.formValidation = useFormValidation;\n  app.$validation = {\n    get: useFormValidationSync,\n    getField: useFieldValidationSync,\n    addGlobalValidator: addGlobalValidator,\n    import: () => useFormValidation()\n  };\n\n  app.stack = useStack;\n  app.queue = useQueue;\n}\n\nfunction handleCrypto(app: any) {\n  app.base64Encode = base64UrlEncode;\n  app.base64Decode = base64UrlDecode;\n  // app.uuid4 = uuid4;\n  app.uid = uid;\n  app.tid = tid;\n  // app.md5 = md5;\n  app.serial = serial;\n}\n\nfunction handleUri(app: any) {\n  app.uri = useSystemUri;\n  app.asset = useAssetUri;\n}\n\nfunction handlerHelper(app: any) {\n  app.domready = domready;\n  app.selectOne = selectOne;\n  app.selectAll = selectAll;\n  app.each = selectAll;\n  app.getBoundedInstance = getBoundedInstance;\n  app.getBoundedInstanceList = getBoundedInstanceList;\n  app.module = module;\n  app.h = h;\n  app.html = html;\n  // app.$get = get;\n  // app.$set = set;\n  app.delegate = delegate;\n  app.debounce = debounce;\n  app.throttle = throttle;\n  app.isDebug = isDebug;\n  app.confirm = simpleConfirm;\n  app.alert = simpleAlert;\n  app.numberFormat = numberFormat;\n  app.sprintf = sprintf;\n  app.vsprintf = vsprintf;\n  // app.genRandomString = genRandomString;\n  // app.defaultsDeep = defaultsDeep;\n}\n\nfunction handleUI(app: any) {\n  app.$ui ??= {};\n  app.$ui.addMessage = renderMessage;\n  app.$ui.clearMessages = clearMessages;\n  app.$ui.notify = notify;\n  app.$ui.clearNotifies = clearNotifies;\n\n  app.$ui.loadAlpine = loadAlpine;\n  app.$ui.initAlpine = initAlpineComponent;\n  app.$ui.beforeAlpineInit = prepareAlpine;\n  app.$ui.prepareAlpine = prepareAlpine;\n\n  app.$ui.mark = mark;\n  app.$ui.tomSelect = useTomSelect;\n  app.$ui.slideUp = slideUp;\n  app.$ui.slideDown = slideDown;\n  app.$ui.slideToggle = slideToggle;\n  app.$ui.fadeOut = fadeOut;\n  app.$ui.fadeIn = fadeIn;\n  app.$ui.highlight = highlight;\n  app.$ui.colorPicker = useColorPicker;\n  app.$ui.disableOnSubmit = useDisableOnSubmit;\n  app.$ui.disableIfStackNotEmpty = useDisableIfStackNotEmpty;\n  app.$ui.checkboxesMultiSelect = useCheckboxesMultiSelect;\n  app.$ui.keepAlive = useKeepAlive;\n  app.$ui.bootstrap = {\n    tooltip: useBs5Tooltip\n  };\n}\n\nasync function handleFormGrid(app: any) {\n  await useFormAsync();\n  await useGridAsync();\n\n  app.form = useForm;\n  app.grid = useGrid;\n}\n"],"names":["module","sprintf","vsprintf"],"mappings":";AAAO,SAAS,aAAa,QAAyB,WAAW,GAAG,WAAW,KAAK,eAAe,KAAK;AACtG,WAAS,OAAO,MAAM;AAEtB,QAAM,MAAM,OAAO,QAAQ,WAAW,WAAW,CAAC,EAAE,SAAA,EAAW,MAAM,GAAG;AACxE,QAAM,QAAQ,CAAA;AAEd,WAAS,IAAI,IAAI,CAAC,EAAE,QAAQ,IAAI,GAAG,KAAK,GAAG;AACzC,UAAM,QAAQ,IAAI,CAAC,EAAE,UAAU,KAAK,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;AAAA,EACvD;AAEA,MAAI,CAAC,IAAI,MAAM,KAAK,eAAe,eAAe,GAAG;AAErD,SAAO,IAAI,KAAK,WAAW,WAAW,GAAG;AAC3C;ACXA,MAAM,UAA0E,CAAA;AAEzE,MAAM,aAAa;AAAA,EAWxB,YAAsB,KAAU;AAAV,SAAA,MAAA;AAAA,EAEtB;AAAA,EAZA,OAAO,QAAQ,KAAU;AACvB,UAAM,SAAS,IAAI,UAAU,IAAI,KAAK,GAAG;AAEzC,QAAI,SAAS,OAAO,OAAO,KAAK,MAAM;AACtC,QAAI,aAAa,OAAO,WAAW,KAAK,MAAM;AAC9C,QAAI,YAAY,OAAO,UAAU,KAAK,MAAM;AAC5C,QAAI,cAAc,OAAO,YAAY,KAAK,MAAM;AAChD,QAAI,gBAAgB,OAAO,cAAc,KAAK,MAAM;AAAA,EACtD;AAAA,EAMA,SAAS,KAA2B;AAClC,WAAO,EAAE,OAAO,GAAG;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,KAAgC;AACxC,QAAI,IAAI,WAAW,GAAG;AACpB,aAAO,KAAK,SAAS,IAAI,CAAC,CAAC;AAAA,IAC7B;AAEA,UAAM,WAA2B,CAAA;AAEjC,QAAI,QAAQ,CAAC,SAAS;AACpB,eAAS;AAAA,QACP,gBAAgB,UAAU,OAAO,KAAK,SAAS,IAAI;AAAA,MAAA;AAAA,IAEvD,CAAC;AAED,WAAO,QAAQ,IAAI,QAAQ;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,KAA8B;AAC1C,QAAI,UAAwB,QAAQ,QAAA;AACpC,QAAI;AACJ,UAAM,UAAiB,CAAA;AAEvB,WAAO,MAAM,IAAI,SAAS;AACxB,UAAI,CAAC,MAAM,QAAQ,GAAG,GAAG;AACvB,cAAM,CAAE,GAAI;AAAA,MACd;AAEA,YAAM,SAAS;AACf,gBAAU,QAAQ;AAAA,QAChB,MAAM,KAAK,OAAO,GAAG,MAAM,EAAE,KAAK,CAAC,MAAM;AACvC,kBAAQ,KAAK,CAAC;AACd,iBAAO;AAAA,QACT,CAAC;AAAA,MAAA;AAAA,IAEL;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAa,KAA8B;AAC/C,QAAI,UAAe,MAAM,KAAK,OAAO,GAAG,GAAG;AAE3C,QAAI,CAAC,MAAM,QAAQ,OAAO,GAAG;AAC3B,gBAAU,CAAC,OAAO;AAAA,IACpB;AAEA,UAAM,SAA2B,QAAkB,IAAI,CAAAA,YAAUA,QAAO,OAAO;AAE/E,aAAS,qBAAqB,CAAC,GAAG,SAAS,oBAAoB,GAAG,MAAM;AAAA,EAC1E;AAAA,EAEA,YAAY,UAA0B;AACpC,UAAM,WAAW,SAAS,MAAM,GAAG;AACnC,UAAM,MAAM,SAAS,IAAA;AAErB,QAAI,WAAW;AACb,aAAO,SAAS,KAAK,GAAG,IAAI,UAAU;AAAA,IACxC;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,WAAW,MAAc;AACvB,QAAI,CAAC,QAAQ,IAAI,GAAG;AAClB,cAAQ,IAAI,IAAI;AAAA,QACd,SAAS,QAAQ,QAAA;AAAA,QACjB,SAAS;AAAA,MAAA;AAAA,IAEb,OAAO;AACL,cAAQ,IAAI,GAAG,UAAA;AAAA,IACjB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,MAAc,UAAwE;AAClG,QAAI,CAAC,QAAQ,IAAI,GAAG;AAClB,UAAI;AACJ,cAAQ,IAAI,IAAI;AAAA,QACd,SAAS,IAAI,QAAQ,CAAC,YAAY;AAChC,cAAI;AAAA,QACN,CAAC;AAAA,MAAA;AAGH,cAAQ,IAAI,EAAE,UAAU;AAAA,IAC1B;AAEA,YAAQ,IAAI,EAAE,QAAQ,KAAK,QAAQ;AAEnC,WAAO,QAAQ,IAAI,EAAE;AAAA,EACvB;AACF;AC1DA,eAAsB,iBAAiB,KAAU;AAC/C,QAAM,OAAO,MAAM,cAAA;AAEnB,MAAI,IAAI,YAAY;AAEpB,YAAU,GAAG;AACb,gBAAc,GAAG;AACjB,eAAa,GAAG;AAEhB,MAAI,KAAK;AACT,MAAI,QAAQ;AACZ,MAAI,QAAQ;AACZ,MAAI,QAAQ;AACZ,MAAI,YAAY;AAEhB,MAAI,UAAU;AACd,MAAI,aAAa,EAAE,IAAI,UAAA;AAEvB,MAAI,aAAa;AACjB,MAAI,gBAAgB;AACpB,MAAI,SAAS;AACb,MAAI,gBAAgB;AAEpB,MAAI,aAAa;AACjB,MAAI,aAAa;AACjB,MAAI,mBAAmB;AACvB,MAAI,gBAAgB;AAEpB,WAAS,GAAG;AAEZ,QAAM,eAAe,GAAG;AAExB,MAAI,iBAAiB;AACrB,MAAI,cAAc;AAAA,IAChB,KAAK;AAAA,IACL,UAAU;AAAA,IACV;AAAA,IACA,QAAQ,MAAM,kBAAA;AAAA,EAAkB;AAGlC,MAAI,QAAQ;AACZ,MAAI,QAAQ;AACd;AAEA,SAAS,aAAa,KAAU;AAC9B,MAAI,eAAe;AACnB,MAAI,eAAe;AAEnB,MAAI,MAAM;AACV,MAAI,MAAM;AAEV,MAAI,SAAS;AACf;AAEA,SAAS,UAAU,KAAU;AAC3B,MAAI,MAAM;AACV,MAAI,QAAQ;AACd;AAEA,SAAS,cAAc,KAAU;AAC/B,MAAI,WAAW;AACf,MAAI,YAAY;AAChB,MAAI,YAAY;AAChB,MAAI,OAAO;AACX,MAAI,qBAAqB;AACzB,MAAI,yBAAyB;AAC7B,MAAI,SAAS;AACb,MAAI,IAAI;AACR,MAAI,OAAO;AAGX,MAAI,WAAW;AACf,MAAI,WAAW;AACf,MAAI,WAAW;AACf,MAAI,UAAU;AACd,MAAI,UAAU;AACd,MAAI,QAAQ;AACZ,MAAI,eAAe;AACnB,MAAI,UAAUC,eAAAA;AACd,MAAI,WAAWC,eAAAA;AAGjB;AAEA,SAAS,SAAS,KAAU;AAC1B,MAAI,QAAQ,CAAA;AACZ,MAAI,IAAI,aAAa;AACrB,MAAI,IAAI,gBAAgB;AACxB,MAAI,IAAI,SAAS;AACjB,MAAI,IAAI,gBAAgB;AAExB,MAAI,IAAI,aAAa;AACrB,MAAI,IAAI,aAAa;AACrB,MAAI,IAAI,mBAAmB;AAC3B,MAAI,IAAI,gBAAgB;AAExB,MAAI,IAAI,OAAO;AACf,MAAI,IAAI,YAAY;AACpB,MAAI,IAAI,UAAU;AAClB,MAAI,IAAI,YAAY;AACpB,MAAI,IAAI,cAAc;AACtB,MAAI,IAAI,UAAU;AAClB,MAAI,IAAI,SAAS;AACjB,MAAI,IAAI,YAAY;AACpB,MAAI,IAAI,cAAc;AACtB,MAAI,IAAI,kBAAkB;AAC1B,MAAI,IAAI,yBAAyB;AACjC,MAAI,IAAI,wBAAwB;AAChC,MAAI,IAAI,YAAY;AACpB,MAAI,IAAI,YAAY;AAAA,IAClB,SAAS;AAAA,EAAA;AAEb;AAEA,eAAe,eAAe,KAAU;AACtC,QAAM,aAAA;AACN,QAAM,aAAA;AAEN,MAAI,OAAO;AACX,MAAI,OAAO;AACb;","x_google_ignoreList":[0]}