{"version":3,"file":"legacy.js","sources":["../../../../../../node_modules/@lyrasoft/ts-toolkit/src/generic/number.ts","../../src/legacy/loader.ts","../../src/legacy/legacy.ts"],"sourcesContent":["export function numberFormat(number: string | number, decimals = 0, decPoint = '.', thousandsSep = ',') {\n  number = Number(number);\n\n  const str = number.toFixed(decimals ? decimals : 0).toString().split('.');\n  const parts = [];\n\n  for (var i = str[0].length; i > 0; i -= 3) {\n    parts.unshift(str[0].substring(Math.max(0, i - 3), i));\n  }\n\n  str[0] = parts.join(thousandsSep ? thousandsSep : ',');\n\n  return str.join(decPoint ? decPoint : '.');\n}\n","import { isDebug } from '../service';\n\nconst imports: Record<string, { promise: Promise<any>; resolve?: Function; }> = {};\n\nexport class LegacyLoader {\n  static install(app: any) {\n    const loader = app.$loader = new this(app);\n\n    app.import = loader.import.bind(loader);\n    app.importSync = loader.importSync.bind(loader);\n    app.importCSS = loader.importCSS.bind(loader);\n    app.minFileName = loader.minFileName.bind(loader);\n    app.afterImported = loader.afterImported.bind(loader);\n  }\n\n  constructor(protected app: any) {\n    //\n  }\n\n  doImport(src: string): Promise<any> {\n    return S.import(src);\n  }\n\n  /**\n   * Import modules or scripts.\n   */\n  import(...src: any[]): Promise<any|any[]> {\n    if (src.length === 1) {\n      return this.doImport(src[0]);\n    }\n\n    const promises: Promise<any>[] = [];\n\n    src.forEach((link) => {\n      promises.push(\n        link instanceof Promise ? link : this.doImport(link)\n      );\n    });\n\n    return Promise.all(promises);\n  }\n\n  /**\n   * Import sync.\n   */\n  importSync(...src: any): Promise<any|any[]> {\n    let promise: Promise<any> = Promise.resolve();\n    let url: string[];\n    const modules: any[] = [];\n\n    while (url = src.shift()) {\n      if (!Array.isArray(url)) {\n        url = [ url ];\n      }\n\n      const target = url;\n      promise = promise.then(\n        () => this.import(...target).then((m) => {\n          modules.push(m);\n          return modules;\n        })\n      );\n    }\n\n    return promise;\n  }\n\n  /**\n   * Import CSS files.\n   */\n  async importCSS(...src: any): Promise<any|any[]> {\n    let modules: any = await this.import(...src);\n\n    if (!Array.isArray(modules)) {\n      modules = [modules];\n    }\n\n    const styles: CSSStyleSheet[] = (modules as any[]).map(module => module.default);\n\n    document.adoptedStyleSheets = [...document.adoptedStyleSheets, ...styles];\n  }\n\n  minFileName(fileName: string): string {\n    const segments = fileName.split('.');\n    const ext = segments.pop();\n\n    if (isDebug()) {\n      return segments.join('.') + '.min.' + ext;\n    }\n\n    return fileName;\n  }\n\n  asImported(name: string) {\n    if (!imports[name]) {\n      imports[name] = {\n        promise: Promise.resolve(),\n        resolve: undefined\n      };\n    } else {\n      imports[name]?.resolve?.();\n    }\n  }\n\n  /**\n   * Add after import hook for some url or id.\n   */\n  afterImported(name: string, callback: (resolve: Function, reject?: Function) => void): Promise<any> {\n    if (!imports[name]) {\n      let r;\n      imports[name] = {\n        promise: new Promise((resolve) => {\n          r = resolve;\n        }),\n      };\n\n      imports[name].resolve = r;\n    }\n\n    imports[name].promise.then(callback);\n\n    return imports[name].promise;\n  }\n}\n\n","import { numberFormat } from '@lyrasoft/ts-toolkit/generic';\r\nimport { sprintf, vsprintf } from 'sprintf-js';\r\nimport {\r\n  addGlobalValidator,\r\n  useBs5Tooltip,\r\n  useCheckboxesMultiSelect,\r\n  useFieldValidationSync,\r\n  useForm,\r\n  useFormAsync,\r\n  useFormValidation,\r\n  useFormValidationSync,\r\n  useGrid,\r\n  useGridAsync,\r\n  useHttpClient,\r\n  useQueue,\r\n  useStack,\r\n  useTomSelect,\r\n  useUniDirective\r\n} from '../composable';\r\nimport {\r\n  __,\r\n  animateTo,\r\n  base64UrlDecode,\r\n  base64UrlEncode,\r\n  clearMessages,\r\n  clearNotifies,\r\n  debounce,\r\n  delegate,\r\n  domready,\r\n  fadeIn,\r\n  fadeOut,\r\n  getBoundedInstance,\r\n  getBoundedInstanceList,\r\n  h,\r\n  highlight,\r\n  html,\r\n  initAlpineComponent,\r\n  isDebug,\r\n  loadAlpine,\r\n  mark,\r\n  module,\r\n  notify,\r\n  prepareAlpine,\r\n  renderMessage,\r\n  route,\r\n  selectAll,\r\n  selectOne,\r\n  serial,\r\n  simpleAlert,\r\n  simpleConfirm,\r\n  slideDown,\r\n  slideToggle,\r\n  slideUp,\r\n  throttle,\r\n  tid,\r\n  uid,\r\n  useAssetUri,\r\n  useColorPicker,\r\n  useDisableIfStackNotEmpty,\r\n  useDisableOnSubmit,\r\n  useKeepAlive,\r\n  useSystemUri\r\n} from '../service';\r\nimport { LegacyLoader } from './loader';\r\n\r\nexport async function useLegacyMethods(app: any) {\r\n  const http = await useHttpClient();\r\n\r\n  app.use(LegacyLoader);\r\n\r\n  handleUri(app);\r\n  handlerHelper(app);\r\n  handleCrypto(app);\r\n\r\n  app.__ = __;\r\n  app.trans = __;\r\n  app.route = route;\r\n  app.$http = http;\r\n  app.directive = useUniDirective;\r\n\r\n  app.animate = animateTo;\r\n  app.$animation = { to: animateTo };\r\n\r\n  app.addMessage = renderMessage;\r\n  app.clearMessages = clearMessages;\r\n  app.notify = notify;\r\n  app.clearNotifies = clearNotifies;\r\n\r\n  app.loadAlpine = loadAlpine;\r\n  app.initAlpine = initAlpineComponent;\r\n  app.beforeAlpineInit = prepareAlpine;\r\n  app.prepareAlpine = prepareAlpine;\r\n\r\n  handleUI(app);\r\n\r\n  await handleFormGrid(app);\r\n\r\n  app.formValidation = useFormValidation;\r\n  app.$validation = {\r\n    get: useFormValidationSync,\r\n    getField: useFieldValidationSync,\r\n    addGlobalValidator: addGlobalValidator,\r\n    import: () => useFormValidation()\r\n  };\r\n\r\n  app.stack = useStack;\r\n  app.queue = useQueue;\r\n}\r\n\r\nfunction handleCrypto(app: any) {\r\n  app.base64Encode = base64UrlEncode;\r\n  app.base64Decode = base64UrlDecode;\r\n  // app.uuid4 = uuid4;\r\n  app.uid = uid;\r\n  app.tid = tid;\r\n  // app.md5 = md5;\r\n  app.serial = serial;\r\n}\r\n\r\nfunction handleUri(app: any) {\r\n  app.uri = useSystemUri;\r\n  app.asset = useAssetUri;\r\n}\r\n\r\nfunction handlerHelper(app: any) {\r\n  app.domready = domready;\r\n  app.selectOne = selectOne;\r\n  app.selectAll = selectAll;\r\n  app.each = selectAll;\r\n  app.getBoundedInstance = getBoundedInstance;\r\n  app.getBoundedInstanceList = getBoundedInstanceList;\r\n  app.module = module;\r\n  app.h = h;\r\n  app.html = html;\r\n  // app.$get = get;\r\n  // app.$set = set;\r\n  app.delegate = delegate;\r\n  app.debounce = debounce;\r\n  app.throttle = throttle;\r\n  app.isDebug = isDebug;\r\n  app.confirm = simpleConfirm;\r\n  app.alert = simpleAlert;\r\n  app.numberFormat = numberFormat;\r\n  app.sprintf = sprintf;\r\n  app.vsprintf = vsprintf;\r\n  // app.genRandomString = genRandomString;\r\n  // app.defaultsDeep = defaultsDeep;\r\n}\r\n\r\nfunction handleUI(app: any) {\r\n  app.$ui ??= {};\r\n  app.$ui.addMessage = renderMessage;\r\n  app.$ui.clearMessages = clearMessages;\r\n  app.$ui.notify = notify;\r\n  app.$ui.clearNotifies = clearNotifies;\r\n\r\n  app.$ui.loadAlpine = loadAlpine;\r\n  app.$ui.initAlpine = initAlpineComponent;\r\n  app.$ui.beforeAlpineInit = prepareAlpine;\r\n  app.$ui.prepareAlpine = prepareAlpine;\r\n\r\n  app.$ui.mark = mark;\r\n  app.$ui.tomSelect = useTomSelect;\r\n  app.$ui.slideUp = slideUp;\r\n  app.$ui.slideDown = slideDown;\r\n  app.$ui.slideToggle = slideToggle;\r\n  app.$ui.fadeOut = fadeOut;\r\n  app.$ui.fadeIn = fadeIn;\r\n  app.$ui.highlight = highlight;\r\n  app.$ui.colorPicker = useColorPicker;\r\n  app.$ui.disableOnSubmit = useDisableOnSubmit;\r\n  app.$ui.disableIfStackNotEmpty = useDisableIfStackNotEmpty;\r\n  app.$ui.checkboxesMultiSelect = useCheckboxesMultiSelect;\r\n  app.$ui.keepAlive = useKeepAlive;\r\n  app.$ui.bootstrap = {\r\n    tooltip: useBs5Tooltip\r\n  };\r\n}\r\n\r\nasync function handleFormGrid(app: any) {\r\n  await useFormAsync();\r\n  await useGridAsync();\r\n\r\n  app.form = useForm;\r\n  app.grid = useGrid;\r\n}\r\n"],"names":["module","sprintf","vsprintf"],"mappings":"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","x_google_ignoreList":[0]}