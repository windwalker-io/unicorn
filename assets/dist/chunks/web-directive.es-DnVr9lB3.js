const disconnectKey = "_webDirectiveDisconnectors";
const defaultOptions = {
  prefix: "w-"
};
class WebDirective {
  constructor(options = {}) {
    this.directives = {};
    this.instances = {};
    this.listenTarget = document.body;
    this.hooks = {
      mounted: {
        before: (directive, node) => {
          node[disconnectKey] = node[disconnectKey] || {};
          node[disconnectKey][directive] = this.observeChildren(node);
          this.instances[directive] = this.instances[directive] || [];
          this.instances[directive].push(node);
        }
      },
      unmounted: {
        after: (directive, node) => {
          if (!node[disconnectKey]) {
            return;
          }
          if (node[disconnectKey][directive]) {
            node[disconnectKey][directive]();
            delete node[disconnectKey][directive];
          }
        }
      }
    };
    this.options = Object.assign({}, defaultOptions, options);
  }
  register(name, handler) {
    const directive = this.getDirectiveAttrName(name);
    this.directives[directive] = handler;
    if (!this.disconnectCallback) {
      return;
    }
    this.mountDirectiveInitial(directive);
  }
  mountDirectiveInitial(directive) {
    [].forEach.call(this.listenTarget.querySelectorAll("[" + directive + "]"), (el) => {
      this.runDirectiveIfExists(directive, el, "mounted");
    });
  }
  remove(name) {
    const directive = this.getDirectiveAttrName(name);
    if (this.instances[directive]) {
      this.instances[directive].forEach((node) => {
        this.runDirectiveIfExists(directive, node, "unmounted");
      });
      delete this.instances[directive];
    }
    delete this.directives[directive];
  }
  getPrefix() {
    return this.options.prefix;
  }
  getDirectiveAttrName(name) {
    return `${this.getPrefix()}${name}`;
  }
  observeRoot(element) {
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        [].forEach.call(mutation.addedNodes, (node) => {
          this.findDirectivesFromNode(node).forEach((directive) => {
            this.runDirectiveIfExists(directive, node, "mounted", mutation);
          });
          for (const directive in this.directives) {
            if ("querySelectorAll" in node) {
              node.querySelectorAll(`[${directive}]`).forEach((node2) => {
                this.runDirectiveIfExists(directive, node2, "mounted", mutation);
              });
            }
          }
        });
        [].forEach.call(mutation.removedNodes, (node) => {
          this.findDirectivesFromNode(node).forEach((directive) => {
            this.runDirectiveIfExists(directive, node, "unmounted", mutation);
          });
        });
        if (mutation.type === "attributes" && mutation.oldValue == null) {
          this.runDirectiveIfExists(mutation.attributeName, mutation.target, "mounted", mutation);
        }
      });
    });
    observer.observe(element, {
      attributes: true,
      attributeOldValue: true,
      childList: true,
      characterData: false,
      subtree: true
    });
    return () => {
      observer.disconnect();
    };
  }
  observeChildren(element) {
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.type === "attributes" && !mutation.target.getAttribute(mutation.attributeName)) {
          this.runDirectiveIfExists(mutation.attributeName, mutation.target, "unmounted", mutation);
        }
        this.findDirectivesFromNode(mutation.target).forEach((directive) => {
          if (mutation.type === "attributes" || mutation.type === "childList") {
            this.runDirectiveIfExists(directive, mutation.target, "updated", mutation);
          }
        });
      });
    });
    observer.observe(element, {
      attributes: true,
      childList: true,
      characterData: true,
      attributeOldValue: true,
      characterDataOldValue: true,
      attributeFilter: Object.keys(this.directives)
    });
    return () => {
      observer.disconnect();
    };
  }
  listen(target) {
    if (this.disconnectCallback) {
      throw new Error("This instance has already listening.");
    }
    this.listenTarget = target || document.body;
    this.disconnectCallback = this.observeRoot(this.listenTarget);
    for (const directive in this.directives) {
      this.mountDirectiveInitial(directive);
    }
  }
  disconnect() {
    if (this.disconnectCallback) {
      this.disconnectCallback();
      this.disconnectCallback = void 0;
    }
  }
  getDirective(directive) {
    return this.directives[directive];
  }
  runDirectiveIfExists(directive, node, task, mutation = void 0) {
    const handler = this.getDirective(directive);
    if (handler && task in handler) {
      if (this.hooks?.[task]?.before) {
        this.hooks[task]?.before?.(directive, node);
      }
      handler[task]?.(node, {
        directive,
        node,
        value: node.getAttribute(directive),
        oldValue: mutation?.oldValue,
        mutation,
        dir: handler
      });
      if (this.hooks?.[task]?.after) {
        this.hooks[task]?.after?.(directive, node);
      }
    }
  }
  findDirectivesFromNode(node) {
    const directives = [];
    if (!node.getAttributeNames) {
      return [];
    }
    node.getAttributeNames().forEach((e) => {
      if (e.startsWith(this.getPrefix())) {
        directives.push(e);
      }
    });
    return directives;
  }
}
export {
  WebDirective as default
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLWRpcmVjdGl2ZS5lcy1EblZyOWxCMy5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3dlYi1kaXJlY3RpdmUvZGlzdC93ZWItZGlyZWN0aXZlLmVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGRpc2Nvbm5lY3RLZXkgPSAnX3dlYkRpcmVjdGl2ZURpc2Nvbm5lY3RvcnMnO1xuY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgcHJlZml4OiAndy0nLFxufTtcbmNsYXNzIFdlYkRpcmVjdGl2ZSB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHRoaXMuZGlyZWN0aXZlcyA9IHt9O1xuICAgICAgICB0aGlzLmluc3RhbmNlcyA9IHt9O1xuICAgICAgICB0aGlzLmxpc3RlblRhcmdldCA9IGRvY3VtZW50LmJvZHk7XG4gICAgICAgIHRoaXMuaG9va3MgPSB7XG4gICAgICAgICAgICBtb3VudGVkOiB7XG4gICAgICAgICAgICAgICAgYmVmb3JlOiAoZGlyZWN0aXZlLCBub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGVbZGlzY29ubmVjdEtleV0gPSBub2RlW2Rpc2Nvbm5lY3RLZXldIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICBub2RlW2Rpc2Nvbm5lY3RLZXldW2RpcmVjdGl2ZV0gPSB0aGlzLm9ic2VydmVDaGlsZHJlbihub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZXNbZGlyZWN0aXZlXSA9IHRoaXMuaW5zdGFuY2VzW2RpcmVjdGl2ZV0gfHwgW107XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VzW2RpcmVjdGl2ZV0ucHVzaChub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5tb3VudGVkOiB7XG4gICAgICAgICAgICAgICAgYWZ0ZXI6IChkaXJlY3RpdmUsIG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFub2RlW2Rpc2Nvbm5lY3RLZXldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGVbZGlzY29ubmVjdEtleV1bZGlyZWN0aXZlXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZVtkaXNjb25uZWN0S2V5XVtkaXJlY3RpdmVdKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgbm9kZVtkaXNjb25uZWN0S2V5XVtkaXJlY3RpdmVdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG4gICAgfVxuICAgIHJlZ2lzdGVyKG5hbWUsIGhhbmRsZXIpIHtcbiAgICAgICAgY29uc3QgZGlyZWN0aXZlID0gdGhpcy5nZXREaXJlY3RpdmVBdHRyTmFtZShuYW1lKTtcbiAgICAgICAgdGhpcy5kaXJlY3RpdmVzW2RpcmVjdGl2ZV0gPSBoYW5kbGVyO1xuICAgICAgICAvLyBJZiBsaXN0ZW4gbm90IHN0YXJ0LCBqdXN0IHJlZ2lzdGVyIGFuZCBiYWNrXG4gICAgICAgIGlmICghdGhpcy5kaXNjb25uZWN0Q2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBsaXN0ZW4gYWxyZWFkeSBzdGFydGVkLCBtb3VudCB0aGlzIGRpcmVjdGl2ZVxuICAgICAgICB0aGlzLm1vdW50RGlyZWN0aXZlSW5pdGlhbChkaXJlY3RpdmUpO1xuICAgIH1cbiAgICBtb3VudERpcmVjdGl2ZUluaXRpYWwoZGlyZWN0aXZlKSB7XG4gICAgICAgIFtdLmZvckVhY2guY2FsbCh0aGlzLmxpc3RlblRhcmdldC5xdWVyeVNlbGVjdG9yQWxsKCdbJyArIGRpcmVjdGl2ZSArICddJyksIChlbCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5ydW5EaXJlY3RpdmVJZkV4aXN0cyhkaXJlY3RpdmUsIGVsLCAnbW91bnRlZCcpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVtb3ZlKG5hbWUpIHtcbiAgICAgICAgY29uc3QgZGlyZWN0aXZlID0gdGhpcy5nZXREaXJlY3RpdmVBdHRyTmFtZShuYW1lKTtcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2VzW2RpcmVjdGl2ZV0pIHtcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VzW2RpcmVjdGl2ZV0uZm9yRWFjaCgobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucnVuRGlyZWN0aXZlSWZFeGlzdHMoZGlyZWN0aXZlLCBub2RlLCAndW5tb3VudGVkJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmluc3RhbmNlc1tkaXJlY3RpdmVdO1xuICAgICAgICB9XG4gICAgICAgIGRlbGV0ZSB0aGlzLmRpcmVjdGl2ZXNbZGlyZWN0aXZlXTtcbiAgICB9XG4gICAgZ2V0UHJlZml4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnByZWZpeDtcbiAgICB9XG4gICAgZ2V0RGlyZWN0aXZlQXR0ck5hbWUobmFtZSkge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5nZXRQcmVmaXgoKX0ke25hbWV9YDtcbiAgICB9XG4gICAgb2JzZXJ2ZVJvb3QoZWxlbWVudCkge1xuICAgICAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHtcbiAgICAgICAgICAgIG11dGF0aW9ucy5mb3JFYWNoKChtdXRhdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEFkZGVkIE5vZGVzXG4gICAgICAgICAgICAgICAgW10uZm9yRWFjaC5jYWxsKG11dGF0aW9uLmFkZGVkTm9kZXMsIChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZERpcmVjdGl2ZXNGcm9tTm9kZShub2RlKS5mb3JFYWNoKChkaXJlY3RpdmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucnVuRGlyZWN0aXZlSWZFeGlzdHMoZGlyZWN0aXZlLCBub2RlLCAnbW91bnRlZCcsIG11dGF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZpbmQgY2hpbGRyZW4gd2l0aCBhbGwgZGlyZWN0aXZlc1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGRpcmVjdGl2ZSBpbiB0aGlzLmRpcmVjdGl2ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgncXVlcnlTZWxlY3RvckFsbCcgaW4gbm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucXVlcnlTZWxlY3RvckFsbChgWyR7ZGlyZWN0aXZlfV1gKS5mb3JFYWNoKChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucnVuRGlyZWN0aXZlSWZFeGlzdHMoZGlyZWN0aXZlLCBub2RlLCAnbW91bnRlZCcsIG11dGF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFtdLmZvckVhY2guY2FsbChtdXRhdGlvbi5yZW1vdmVkTm9kZXMsIChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZERpcmVjdGl2ZXNGcm9tTm9kZShub2RlKS5mb3JFYWNoKChkaXJlY3RpdmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucnVuRGlyZWN0aXZlSWZFeGlzdHMoZGlyZWN0aXZlLCBub2RlLCAndW5tb3VudGVkJywgbXV0YXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2F0dHJpYnV0ZXMnICYmIG11dGF0aW9uLm9sZFZhbHVlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ydW5EaXJlY3RpdmVJZkV4aXN0cyhtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lLCBtdXRhdGlvbi50YXJnZXQsICdtb3VudGVkJywgbXV0YXRpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50LCB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgICAgICAgYXR0cmlidXRlT2xkVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgICAgICBjaGFyYWN0ZXJEYXRhOiBmYWxzZSxcbiAgICAgICAgICAgIHN1YnRyZWU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIG9ic2VydmVDaGlsZHJlbihlbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9ucykgPT4ge1xuICAgICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goKG11dGF0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlXG4gICAgICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdhdHRyaWJ1dGVzJyAmJiAhbXV0YXRpb24udGFyZ2V0LmdldEF0dHJpYnV0ZShtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJ1bkRpcmVjdGl2ZUlmRXhpc3RzKG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUsIG11dGF0aW9uLnRhcmdldCwgJ3VubW91bnRlZCcsIG11dGF0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5maW5kRGlyZWN0aXZlc0Zyb21Ob2RlKG11dGF0aW9uLnRhcmdldCkuZm9yRWFjaCgoZGlyZWN0aXZlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEF0dHJpYnV0ZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdhdHRyaWJ1dGVzJyB8fCBtdXRhdGlvbi50eXBlID09PSAnY2hpbGRMaXN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ydW5EaXJlY3RpdmVJZkV4aXN0cyhkaXJlY3RpdmUsIG11dGF0aW9uLnRhcmdldCwgJ3VwZGF0ZWQnLCBtdXRhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50LCB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZSxcbiAgICAgICAgICAgIGF0dHJpYnV0ZU9sZFZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgY2hhcmFjdGVyRGF0YU9sZFZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBPYmplY3Qua2V5cyh0aGlzLmRpcmVjdGl2ZXMpXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBsaXN0ZW4odGFyZ2V0KSB7XG4gICAgICAgIGlmICh0aGlzLmRpc2Nvbm5lY3RDYWxsYmFjaykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGluc3RhbmNlIGhhcyBhbHJlYWR5IGxpc3RlbmluZy4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpc3RlblRhcmdldCA9IHRhcmdldCB8fCBkb2N1bWVudC5ib2R5O1xuICAgICAgICB0aGlzLmRpc2Nvbm5lY3RDYWxsYmFjayA9IHRoaXMub2JzZXJ2ZVJvb3QodGhpcy5saXN0ZW5UYXJnZXQpO1xuICAgICAgICAvLyBNb3VudCByZWdpc3RlcmVkIGRpcmVjdGl2ZSBiZWZvcmUgbGlzdGVuLlxuICAgICAgICBmb3IgKGNvbnN0IGRpcmVjdGl2ZSBpbiB0aGlzLmRpcmVjdGl2ZXMpIHtcbiAgICAgICAgICAgIHRoaXMubW91bnREaXJlY3RpdmVJbml0aWFsKGRpcmVjdGl2ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGlzY29ubmVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzY29ubmVjdENhbGxiYWNrKSB7XG4gICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3RDYWxsYmFjaygpO1xuICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0Q2FsbGJhY2sgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RGlyZWN0aXZlKGRpcmVjdGl2ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RpdmVzW2RpcmVjdGl2ZV07XG4gICAgfVxuICAgIHJ1bkRpcmVjdGl2ZUlmRXhpc3RzKGRpcmVjdGl2ZSwgbm9kZSwgdGFzaywgbXV0YXRpb24gPSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuZ2V0RGlyZWN0aXZlKGRpcmVjdGl2ZSk7XG4gICAgICAgIGlmIChoYW5kbGVyICYmIHRhc2sgaW4gaGFuZGxlcikge1xuICAgICAgICAgICAgaWYgKHRoaXMuaG9va3M/Llt0YXNrXT8uYmVmb3JlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ob29rc1t0YXNrXT8uYmVmb3JlPy4oZGlyZWN0aXZlLCBub2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhhbmRsZXJbdGFza10/Lihub2RlLCB7XG4gICAgICAgICAgICAgICAgZGlyZWN0aXZlLFxuICAgICAgICAgICAgICAgIG5vZGUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IG5vZGUuZ2V0QXR0cmlidXRlKGRpcmVjdGl2ZSksXG4gICAgICAgICAgICAgICAgb2xkVmFsdWU6IG11dGF0aW9uPy5vbGRWYWx1ZSxcbiAgICAgICAgICAgICAgICBtdXRhdGlvbixcbiAgICAgICAgICAgICAgICBkaXI6IGhhbmRsZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHRoaXMuaG9va3M/Llt0YXNrXT8uYWZ0ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhvb2tzW3Rhc2tdPy5hZnRlcj8uKGRpcmVjdGl2ZSwgbm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZmluZERpcmVjdGl2ZXNGcm9tTm9kZShub2RlKSB7XG4gICAgICAgIGNvbnN0IGRpcmVjdGl2ZXMgPSBbXTtcbiAgICAgICAgaWYgKCFub2RlLmdldEF0dHJpYnV0ZU5hbWVzKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgbm9kZS5nZXRBdHRyaWJ1dGVOYW1lcygpLmZvckVhY2goKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlLnN0YXJ0c1dpdGgodGhpcy5nZXRQcmVmaXgoKSkpIHtcbiAgICAgICAgICAgICAgICBkaXJlY3RpdmVzLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlcztcbiAgICB9XG59XG5cbmV4cG9ydCB7IFdlYkRpcmVjdGl2ZSBhcyBkZWZhdWx0IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD13ZWItZGlyZWN0aXZlLmVzLmpzLm1hcFxuIl0sIm5hbWVz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
