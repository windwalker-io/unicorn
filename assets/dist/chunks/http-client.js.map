{"version":3,"file":"http-client.js","sources":["../../../../../../node_modules/url-template/lib/url-template.js","../../src/module/http-client.ts"],"sourcesContent":["function encodeReserved(str) {\n  return str.split(/(%[0-9A-Fa-f]{2})/g).map(function (part) {\n    if (!/%[0-9A-Fa-f]/.test(part)) {\n      part = encodeURI(part).replace(/%5B/g, '[').replace(/%5D/g, ']');\n    }\n    return part;\n  }).join('');\n}\n\nfunction encodeUnreserved(str) {\n  return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {\n    return '%' + c.charCodeAt(0).toString(16).toUpperCase();\n  });\n}\n\nfunction encodeValue(operator, value, key) {\n  value = (operator === '+' || operator === '#') ? encodeReserved(value) : encodeUnreserved(value);\n\n  if (key) {\n    return encodeUnreserved(key) + '=' + value;\n  } else {\n    return value;\n  }\n}\n\nfunction isDefined(value) {\n  return value !== undefined && value !== null;\n}\n\nfunction isKeyOperator(operator) {\n  return operator === ';' || operator === '&' || operator === '?';\n}\n\nfunction getValues(context, operator, key, modifier) {\n  var value = context[key],\n      result = [];\n\n  if (isDefined(value) && value !== '') {\n    if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {\n      value = value.toString();\n\n      if (modifier && modifier !== '*') {\n        value = value.substring(0, parseInt(modifier, 10));\n      }\n\n      result.push(encodeValue(operator, value, isKeyOperator(operator) ? key : null));\n    } else {\n      if (modifier === '*') {\n        if (Array.isArray(value)) {\n          value.filter(isDefined).forEach(function (value) {\n            result.push(encodeValue(operator, value, isKeyOperator(operator) ? key : null));\n          });\n        } else {\n          Object.keys(value).forEach(function (k) {\n            if (isDefined(value[k])) {\n              result.push(encodeValue(operator, value[k], k));\n            }\n          });\n        }\n      } else {\n        var tmp = [];\n\n        if (Array.isArray(value)) {\n          value.filter(isDefined).forEach(function (value) {\n            tmp.push(encodeValue(operator, value));\n          });\n        } else {\n          Object.keys(value).forEach(function (k) {\n            if (isDefined(value[k])) {\n              tmp.push(encodeUnreserved(k));\n              tmp.push(encodeValue(operator, value[k].toString()));\n            }\n          });\n        }\n\n        if (isKeyOperator(operator)) {\n          result.push(encodeUnreserved(key) + '=' + tmp.join(','));\n        } else if (tmp.length !== 0) {\n          result.push(tmp.join(','));\n        }\n      }\n    }\n  } else {\n    if (operator === ';') {\n      if (isDefined(value)) {\n        result.push(encodeUnreserved(key));\n      }\n    } else if (value === '' && (operator === '&' || operator === '?')) {\n      result.push(encodeUnreserved(key) + '=');\n    } else if (value === '') {\n      result.push('');\n    }\n  }\n  return result;\n}\n\nexport function parseTemplate(template) {\n  var operators = ['+', '#', '.', '/', ';', '?', '&'];\n\n  return {\n    expand: function (context) {\n      return template.replace(/\\{([^\\{\\}]+)\\}|([^\\{\\}]+)/g, function (_, expression, literal) {\n        if (expression) {\n          var operator = null,\n              values = [];\n\n          if (operators.indexOf(expression.charAt(0)) !== -1) {\n            operator = expression.charAt(0);\n            expression = expression.substr(1);\n          }\n\n          expression.split(/,/g).forEach(function (variable) {\n            var tmp = /([^:\\*]*)(?::(\\d+)|(\\*))?/.exec(variable);\n            values.push.apply(values, getValues(context, operator, tmp[1], tmp[2] || tmp[3]));\n          });\n\n          if (operator && operator !== '+') {\n            var separator = ',';\n\n            if (operator === '?') {\n              separator = '&';\n            } else if (operator !== '#') {\n              separator = operator;\n            }\n            return (values.length !== 0 ? operator : '') + values.join(separator);\n          } else {\n            return values.join(',');\n          }\n        } else {\n          return encodeReserved(literal);\n        }\n      });\n    }\n  };\n}\n","import type { AxiosInstance, AxiosRequestConfig, AxiosResponse, CreateAxiosDefaults } from 'axios';\r\nimport AxiosStatic, { AxiosError, isAxiosError, isCancel } from 'axios';\r\nimport { parseTemplate } from 'url-template';\r\nimport { data } from '../data';\r\nimport { route } from '../service';\r\n\r\nexport interface ApiReturn<T = any> {\r\n  success: boolean;\r\n  message?: string;\r\n  code: number;\r\n  status: number;\r\n  data: T;\r\n}\r\n\r\ndeclare module 'axios' {\r\n  export interface AxiosRequestConfig {\r\n    vars?: Record<string, any>;\r\n    methodSimulate?: string;\r\n    methodSimulateByHeader?: boolean;\r\n  }\r\n\r\n  export interface CreateAxiosDefaults {\r\n  }\r\n}\r\n\r\nfunction prepareAxios(axios: AxiosInstance): AxiosInstance {\r\n  axios.interceptors.request.use((config) => {\r\n    config.headers['X-CSRF-Token'] = data('csrf-token');\r\n\r\n    if (config.url && config.url.startsWith('@')) {\r\n      config.url = route(config.url);\r\n    }\r\n\r\n    if (config?.vars && config.url) {\r\n      const tmpl = parseTemplate(config.url);\r\n      config.url = tmpl.expand(config.vars || {});\r\n    }\r\n\r\n    // Simulate methods\r\n    if (config.methodSimulate) {\r\n      if (config.methodSimulateByHeader) {\r\n        config.headers['X-HTTP-Method-Override'] = config;\r\n      } else if (typeof config.data === 'object') {\r\n        config.data['_method'] = config.method;\r\n      } else if (typeof config.data === 'string') {\r\n        if (config.data.includes('?')) {\r\n          config.data += '&_method=' + config.method;\r\n        } else {\r\n          config.data += '?_method=' + config.method;\r\n        }\r\n      }\r\n\r\n      if (config.method?.toLowerCase() !== 'get') {\r\n        config.method = 'POST';\r\n      }\r\n    }\r\n\r\n    return config;\r\n  });\r\n\r\n  return axios;\r\n}\r\n\r\nexport type UnicornHttpClient = ReturnType<typeof createHttpClient>;\r\n\r\nexport function createHttpClient(config?: CreateAxiosDefaults | AxiosInstance) {\r\n  const axios = config && 'interceptors' in config\r\n    ? config\r\n    : AxiosStatic.create(config ?? {});\r\n\r\n  prepareAxios(axios);\r\n\r\n  function requestMiddleware(callback: Parameters<AxiosInstance['interceptors']['request']['use']>[0]) {\r\n    return axios.interceptors.request.use(callback);\r\n  }\r\n\r\n  function responseMiddleware(callback: Parameters<AxiosInstance['interceptors']['response']['use']>[0]) {\r\n    return axios.interceptors.response.use(callback);\r\n  }\r\n\r\n  /**\r\n   * Send a GET request.\r\n   */\r\n  async function get<T = any, D = any>(\r\n    url: string,\r\n    options: Partial<AxiosRequestConfig> = {}\r\n  ): Promise<AxiosResponse<T, D>> {\r\n    options.url = url;\r\n    options.method = 'GET';\r\n\r\n    return request(options);\r\n  }\r\n\r\n  /**\r\n   * Send a POST request.\r\n   */\r\n  async function post<T = any, D = any>(\r\n    url: string,\r\n    data?: any,\r\n    options: Partial<AxiosRequestConfig> = {}\r\n  ): Promise<AxiosResponse<T, D>> {\r\n    options.url = url;\r\n    options.method = 'POST';\r\n    options.data = data;\r\n\r\n    return request(options);\r\n  }\r\n\r\n  /**\r\n   * Send a PUT request.\r\n   *\r\n   * @param {string} url\r\n   * @param {any} data\r\n   * @param {AxiosRequestConfig} options\r\n   *\r\n   * @returns {Promise<AxiosResponse>}\r\n   */\r\n  async function put<T = any, D = any>(\r\n    url: string,\r\n    data?: any,\r\n    options: Partial<AxiosRequestConfig> = {}\r\n  ): Promise<AxiosResponse<T, D>> {\r\n    options.url = url;\r\n    options.method = 'PUT';\r\n    options.data = data;\r\n\r\n    return request(options);\r\n  }\r\n\r\n  /**\r\n   * Send a PATCH request.\r\n   *\r\n   * @param {string} url\r\n   * @param {any} data\r\n   * @param {AxiosRequestConfig} options\r\n   *\r\n   * @returns {Promise<AxiosResponse>}\r\n   */\r\n  async function patch<T = any, D = any>(\r\n    url: string,\r\n    data?: any,\r\n    options: Partial<AxiosRequestConfig> = {}\r\n  ): Promise<AxiosResponse<T, D>> {\r\n    options.url = url;\r\n    options.method = 'PATCH';\r\n    options.data = data;\r\n\r\n    return request(options);\r\n  }\r\n\r\n  /**\r\n   * Send a DELETE request.\r\n   *\r\n   * @param {string} url\r\n   * @param {any} data\r\n   * @param {AxiosRequestConfig} options\r\n   *\r\n   * @returns {Promise<AxiosResponse>}\r\n   */\r\n  async function deletes<T = any, D = any>(\r\n    url: string,\r\n    data?: any,\r\n    options: Partial<AxiosRequestConfig> = {}\r\n  ): Promise<AxiosResponse<T, D>> {\r\n    options.url = url;\r\n    options.method = 'DELETE';\r\n    options.data = data;\r\n\r\n    return request(options);\r\n  }\r\n\r\n  /**\r\n   * Send a HEAD request.\r\n   *\r\n   * @param {string} url\r\n   * @param {AxiosRequestConfig} options\r\n   *\r\n   * @returns {Promise<AxiosResponse>}\r\n   */\r\n  async function head<T = any, D = any>(\r\n    url: string,\r\n    options: Partial<AxiosRequestConfig> = {}\r\n  ): Promise<AxiosResponse<T, D>> {\r\n    options.url = url;\r\n    options.method = 'HEAD';\r\n\r\n    return request(options);\r\n  }\r\n\r\n  /**\r\n   * Send a OPTIONS request.\r\n   *\r\n   * @param {string} url\r\n   * @param {AxiosRequestConfig} options\r\n   *\r\n   * @returns {Promise<AxiosResponse>}\r\n   */\r\n  async function options<T = any, D = any>(\r\n    url: string,\r\n    options: Partial<AxiosRequestConfig> = {}\r\n  ): Promise<AxiosResponse<T, D>> {\r\n    options.url = url;\r\n    options.method = 'OPTIONS';\r\n\r\n    return request(options);\r\n  }\r\n\r\n  /**\r\n   * Send request.\r\n   */\r\n  async function request<T = any, D = any>(options: AxiosRequestConfig): Promise<AxiosResponse<T, D>> {\r\n    try {\r\n      return await axios(options);\r\n    } catch (e) {\r\n      (e as any).originMessage = (e as Error).message;\r\n\r\n      const err = e as AxiosError<any>;\r\n\r\n      if (err.response?.data?.message) {\r\n        err.message = err.response.data.message;\r\n      }\r\n\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  return {\r\n    axios,\r\n    request,\r\n    get,\r\n    post,\r\n    put,\r\n    patch,\r\n    delete: deletes,\r\n    head,\r\n    options,\r\n    requestMiddleware,\r\n    responseMiddleware,\r\n    isCancel,\r\n    AxiosError,\r\n    isAxiosError,\r\n  };\r\n}\r\n\r\nexport interface UnicornHttpModule {\r\n  UnicornHttpClient: UnicornHttpClient;\r\n  createHttpClient: typeof createHttpClient;\r\n}\r\n"],"names":["value","options","data"],"mappings":"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","x_google_ignoreList":[0]}