import { Tab } from "bootstrap";
import { d as useUniDirective, b as module, m as mergeDeep, a as selectOne, H as sleep, s as selectAll } from "./unicorn-D5cXQeSK.js";
const defaultOptions = {
  tabItemSelector: "[data-toggle=tab],[data-bs-toggle=tab],[data-toggle=pill],[data-bs-toggle=pill]",
  delay: 0
};
class KeepTab {
  $element;
  tabButtons;
  storageKey = "";
  options;
  constructor(selector, options = {}) {
    options = mergeDeep({}, defaultOptions, options);
    let uid;
    if (typeof selector === "object") {
      uid = options.uid || selector.id;
    } else {
      uid = selector;
    }
    const $element = this.$element = selectOne(selector);
    if (!$element) {
      console.warn(`[KeepTab] Element ${selector} not found.`);
      return;
    }
    this.$element = $element;
    this.tabButtons = $element.querySelectorAll(this.options.tabItemSelector);
    this.options = options;
    this.init(uid);
  }
  async init(uid) {
    this.storageKey = "tab-href-" + await this.hashCode(location.href + ":" + uid);
    this.bindEvents();
    await sleep(this.options.delay || 0);
    this.switchTab();
  }
  bindEvents() {
    [].forEach.call(this.tabButtons, (button) => {
      button.addEventListener("click", () => {
        window.localStorage.setItem(this.storageKey, this.getButtonHref(button));
      });
    });
  }
  getButtonHref(button) {
    return button.dataset.bsTarget || button.dataset.target || button.href;
  }
  findTabButtonByHref(href) {
    return selectAll(this.options.tabItemSelector).filter((button) => {
      if (button.href === href) {
        return true;
      }
      if (button.dataset.bsTarget === href) {
        return true;
      }
      return button.dataset.target === href;
    }).shift();
  }
  activateTab(href) {
    const tabTrigger = this.findTabButtonByHref(href);
    if (tabTrigger) {
      Tab.getOrCreateInstance(tabTrigger).show();
    }
  }
  hasTab(href) {
    return this.findTabButtonByHref(href) != null;
  }
  /**
   * Switch tab.
   *
   * @returns {boolean}
   */
  switchTab() {
    if (localStorage.getItem(this.storageKey)) {
      if (!this.hasTab(localStorage.getItem(this.storageKey) || "")) {
        localStorage.removeItem(this.storageKey);
        return true;
      }
      const tabhref = localStorage.getItem(this.storageKey) || "";
      this.activateTab(tabhref);
    }
  }
  /**
   * Hash code.
   */
  async hashCode(text) {
    const msgBuffer = new TextEncoder().encode(text);
    const hashBuffer = await globalThis.crypto.subtle.digest("SHA-256", msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
  }
}
const ready = /* @__PURE__ */ useUniDirective("keeptab", {
  mounted(el, { value }) {
    const options = JSON.parse(value || "{}");
    module(el, "uni.keeptab", () => new KeepTab(el, options));
  }
});
export {
  KeepTab,
  ready
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2VlcC10YWItQ1pDd3JfZGIuanMiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ib290c3RyYXAva2VlcC10YWIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlVW5pRGlyZWN0aXZlIH0gZnJvbSAnLi4vY29tcG9zYWJsZSc7XG5pbXBvcnQgeyBtb2R1bGUsIHNlbGVjdEFsbCwgc2VsZWN0T25lLCBzbGVlcCB9IGZyb20gJy4uL3NlcnZpY2UnO1xuaW1wb3J0IHsgVGFiIH0gZnJvbSAnYm9vdHN0cmFwJztcbmltcG9ydCB7IG1lcmdlRGVlcCB9IGZyb20gJy4uL3V0aWxpdGllcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgS2VlcFRhYk9wdGlvbnMge1xuICB1aWQ/OiBzdHJpbmc7XG4gIGRlbGF5PzogbnVtYmVyO1xuICB0YWJJdGVtU2VsZWN0b3I/OiBzdHJpbmc7XG59XG5cbmNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICB0YWJJdGVtU2VsZWN0b3I6ICdbZGF0YS10b2dnbGU9dGFiXSxbZGF0YS1icy10b2dnbGU9dGFiXSxbZGF0YS10b2dnbGU9cGlsbF0sW2RhdGEtYnMtdG9nZ2xlPXBpbGxdJyxcbiAgZGVsYXk6IDAsXG59O1xuXG5leHBvcnQgY2xhc3MgS2VlcFRhYiB7XG4gICRlbGVtZW50OiBIVE1MRWxlbWVudDtcbiAgdGFiQnV0dG9uczogTm9kZUxpc3RPZjxIVE1MRWxlbWVudD47XG4gIHN0b3JhZ2VLZXk6IHN0cmluZyA9ICcnO1xuICBvcHRpb25zOiBhbnk7XG5cbiAgY29uc3RydWN0b3Ioc2VsZWN0b3I6IEhUTUxFbGVtZW50IHwgc3RyaW5nLCBvcHRpb25zOiBLZWVwVGFiT3B0aW9ucyA9IHt9KSB7XG4gICAgb3B0aW9ucyA9IG1lcmdlRGVlcCh7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuICAgIGxldCB1aWQ6IHN0cmluZztcblxuICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdvYmplY3QnKSB7XG4gICAgICB1aWQgPSBvcHRpb25zLnVpZCB8fCBzZWxlY3Rvci5pZDtcbiAgICB9IGVsc2Uge1xuICAgICAgdWlkID0gc2VsZWN0b3I7XG4gICAgfVxuXG4gICAgY29uc3QgJGVsZW1lbnQgPSB0aGlzLiRlbGVtZW50ID0gc2VsZWN0T25lPEhUTUxFbGVtZW50PihzZWxlY3RvcikhO1xuXG4gICAgaWYgKCEkZWxlbWVudCkge1xuICAgICAgY29uc29sZS53YXJuKGBbS2VlcFRhYl0gRWxlbWVudCAke3NlbGVjdG9yfSBub3QgZm91bmQuYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy4kZWxlbWVudCA9ICRlbGVtZW50O1xuICAgIHRoaXMudGFiQnV0dG9ucyA9ICRlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5vcHRpb25zLnRhYkl0ZW1TZWxlY3Rvcik7XG5cbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgdGhpcy5pbml0KHVpZCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgYXN5bmMgaW5pdCh1aWQ6IHN0cmluZykge1xuICAgIHRoaXMuc3RvcmFnZUtleSA9ICd0YWItaHJlZi0nICsgYXdhaXQgdGhpcy5oYXNoQ29kZShsb2NhdGlvbi5ocmVmICsgJzonICsgdWlkKTtcblxuICAgIHRoaXMuYmluZEV2ZW50cygpO1xuXG4gICAgYXdhaXQgc2xlZXAodGhpcy5vcHRpb25zLmRlbGF5IHx8IDApO1xuXG4gICAgdGhpcy5zd2l0Y2hUYWIoKTtcbiAgfVxuXG4gIGJpbmRFdmVudHMoKSB7XG4gICAgW10uZm9yRWFjaC5jYWxsKHRoaXMudGFiQnV0dG9ucywgKGJ1dHRvbjogSFRNTEFuY2hvckVsZW1lbnQpID0+IHtcbiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgLy8gU3RvcmUgdGhlIHNlbGVjdGVkIHRhYiBocmVmIGluIGxvY2Fsc3RvcmFnZVxuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5zdG9yYWdlS2V5LCB0aGlzLmdldEJ1dHRvbkhyZWYoYnV0dG9uKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEJ1dHRvbkhyZWYoYnV0dG9uOiBIVE1MQW5jaG9yRWxlbWVudCkge1xuICAgIHJldHVybiBidXR0b24uZGF0YXNldC5ic1RhcmdldCB8fCBidXR0b24uZGF0YXNldC50YXJnZXQgfHwgYnV0dG9uLmhyZWY7XG4gIH1cblxuICBmaW5kVGFiQnV0dG9uQnlIcmVmKGhyZWY6IHN0cmluZykge1xuICAgIHJldHVybiBzZWxlY3RBbGw8SFRNTEFuY2hvckVsZW1lbnQ+KHRoaXMub3B0aW9ucy50YWJJdGVtU2VsZWN0b3IpXG4gICAgICAuZmlsdGVyKChidXR0b246IEhUTUxBbmNob3JFbGVtZW50KSA9PiB7XG4gICAgICAgIGlmIChidXR0b24uaHJlZiA9PT0gaHJlZikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGJ1dHRvbi5kYXRhc2V0LmJzVGFyZ2V0ID09PSBocmVmKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYnV0dG9uLmRhdGFzZXQudGFyZ2V0ID09PSBocmVmO1xuICAgICAgfSlcbiAgICAgIC5zaGlmdCgpO1xuICB9XG5cbiAgYWN0aXZhdGVUYWIoaHJlZjogc3RyaW5nKSB7XG4gICAgY29uc3QgdGFiVHJpZ2dlciA9IHRoaXMuZmluZFRhYkJ1dHRvbkJ5SHJlZihocmVmKTtcblxuICAgIGlmICh0YWJUcmlnZ2VyKSB7XG4gICAgICBUYWIuZ2V0T3JDcmVhdGVJbnN0YW5jZSh0YWJUcmlnZ2VyKS5zaG93KCk7XG4gICAgfVxuICB9XG5cbiAgaGFzVGFiKGhyZWY6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZpbmRUYWJCdXR0b25CeUhyZWYoaHJlZikgIT0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTd2l0Y2ggdGFiLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICovXG4gIHN3aXRjaFRhYigpIHtcbiAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5zdG9yYWdlS2V5KSkge1xuICAgICAgLy8gV2hlbiBtb3ZpbmcgZnJvbSB0YWIgYXJlYSB0byBhIGRpZmZlcmVudCB2aWV3XG4gICAgICBpZiAoIXRoaXMuaGFzVGFiKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuc3RvcmFnZUtleSkgfHwgJycpKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMuc3RvcmFnZUtleSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhbiBkZWZhdWx0IHRhYnNcbiAgICAgIC8vIHNlbGVjdE9uZSh0aGlzLiRlbGVtZW50LCAnW2RhdGEtdG9nZ2xlPVwidGFiXCJdLCBbZGF0YS1icy10b2dnbGU9dGFiXScpXG4gICAgICAvLyB0aGlzLiRlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2FbZGF0YS10b2dnbGU9XCJ0YWJcIl0nKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAgIGNvbnN0IHRhYmhyZWYgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLnN0b3JhZ2VLZXkpIHx8ICcnO1xuXG4gICAgICAvLyBBZGQgYWN0aXZlIGF0dHJpYnV0ZSBmb3Igc2VsZWN0ZWQgdGFiIGluZGljYXRlZCBieSB1cmxcbiAgICAgIHRoaXMuYWN0aXZhdGVUYWIodGFiaHJlZik7XG5cbiAgICAgIC8vIENoZWNrIHdoZXRoZXIgaW50ZXJuYWwgdGFiIGlzIHNlbGVjdGVkIChpbiBmb3JtYXQgPHRhYm5hbWU+LTxpZD4pXG4gICAgICAvLyBjb25zdCBzZXBlcmF0b3JJbmRleCA9IHRhYmhyZWYuaW5kZXhPZignLScpO1xuICAgICAgLy9cbiAgICAgIC8vIGlmIChzZXBlcmF0b3JJbmRleCAhPT0gLTEpIHtcbiAgICAgIC8vICAgY29uc3Qgc2luZ3VsYXIgPSB0YWJocmVmLnN1YnN0cmluZygwLCBzZXBlcmF0b3JJbmRleCk7XG4gICAgICAvLyAgIGNvbnN0IHBsdXJhbCA9IHNpbmd1bGFyICsgJ3MnO1xuICAgICAgLy9cbiAgICAgIC8vICAgdGhpcy5hY3RpdmF0ZVRhYihwbHVyYWwpO1xuICAgICAgLy8gfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYXNoIGNvZGUuXG4gICAqL1xuICBhc3luYyBoYXNoQ29kZSh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IG1zZ0J1ZmZlciA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSh0ZXh0KTtcbiAgICBjb25zdCBoYXNoQnVmZmVyID0gYXdhaXQgZ2xvYmFsVGhpcy5jcnlwdG8uc3VidGxlLmRpZ2VzdChcIlNIQS0yNTZcIiwgbXNnQnVmZmVyKTtcbiAgICBjb25zdCBoYXNoQXJyYXkgPSBBcnJheS5mcm9tKG5ldyBVaW50OEFycmF5KGhhc2hCdWZmZXIpKTtcbiAgICByZXR1cm4gaGFzaEFycmF5Lm1hcChiID0+IGIudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIFwiMFwiKSkuam9pbihcIlwiKTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgcmVhZHkgPSB1c2VVbmlEaXJlY3RpdmUoJ2tlZXB0YWInLCB7XG4gIG1vdW50ZWQoZWwsIHsgdmFsdWUgfSkge1xuICAgIGNvbnN0IG9wdGlvbnM6IEtlZXBUYWJPcHRpb25zID0gSlNPTi5wYXJzZSh2YWx1ZSB8fCAne30nKTtcblxuICAgIG1vZHVsZShlbCwgJ3VuaS5rZWVwdGFiJywgKCkgPT4gbmV3IEtlZXBUYWIoZWwsIG9wdGlvbnMpKTtcbiAgfVxufSk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgS2VlcFRhYk1vZHVsZSB7XG4gIEtlZXBUYWI6IHR5cGVvZiBLZWVwVGFiO1xuICByZWFkeTogdHlwZW9mIHJlYWR5O1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBV0EsTUFBTSxpQkFBaUI7QUFBQSxFQUNyQixpQkFBaUI7QUFBQSxF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
