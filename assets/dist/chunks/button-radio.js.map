{"version":3,"file":"button-radio.js","sources":["../../src/bootstrap/button-radio.ts"],"sourcesContent":["import { useUniDirective } from '../composable';\r\nimport { data } from '../data';\r\nimport { getBoundedInstance, h, selectAll, selectOne } from '../service';\r\nimport { mergeDeep } from '../utilities';\r\n\r\nexport interface ButtonRadioOptions {\r\n  selector?: string;\r\n  buttonClass?: string;\r\n  activeClass?: string;\r\n  color?: {\r\n    'default'?: string;\r\n    green?: string;\r\n    red?: string;\r\n    blue?: string;\r\n  };\r\n}\r\n\r\nconst defaultOptions = {\r\n  selector: '.btn-group .radio',\r\n  buttonClass: 'btn',\r\n  activeClass: 'active',\r\n  color: {\r\n    'default': 'btn-default btn-outline-secondary',\r\n    green: 'btn-success',\r\n    red: 'btn-danger',\r\n    blue: 'btn-primary'\r\n  }\r\n};\r\n\r\nexport class ButtonRadio {\r\n  wrapper: HTMLElement;\r\n  element: HTMLElement;\r\n  radios: HTMLInputElement[] = [];\r\n  inputs: HTMLInputElement[] = [];\r\n  buttons: HTMLButtonElement[] = [];\r\n  colors: string[] = [];\r\n  options: Required<ButtonRadioOptions>;\r\n\r\n  static handle(el: HTMLElement | string, options: ButtonRadioOptions = {}) {\r\n    return getBoundedInstance(el, 'button-radio', (el: HTMLElement) => {\r\n      return new this(el, options);\r\n    });\r\n  }\r\n\r\n  constructor(selector: HTMLElement | string, options: ButtonRadioOptions = {}) {\r\n    this.element = selectOne<HTMLElement>(selector)!;\r\n    this.options = mergeDeep({}, defaultOptions, options);\r\n    let wrapper: HTMLElement;\r\n\r\n    // Turn radios into btn-group\r\n\r\n    if (this.element.dataset.fieldInput != null) {\r\n      wrapper = this.element;\r\n    } else {\r\n      wrapper = this.element.querySelector('[data-field-input]')!;\r\n    }\r\n\r\n    this.wrapper = wrapper;\r\n    let inputGroup = wrapper.querySelector<HTMLElement>('.btn-group')!;\r\n    const exists = inputGroup != null;\r\n\r\n    if (!inputGroup) {\r\n      inputGroup = h('div', { class: 'btn-group' })\r\n    }\r\n\r\n    this.radios = selectAll(wrapper.querySelectorAll<HTMLInputElement>('.radio'));\r\n\r\n    this.radios.forEach(radio => {\r\n      const button = this.prepareButton(radio, exists);\r\n\r\n      if (!exists) {\r\n        inputGroup.appendChild(button);\r\n      }\r\n    });\r\n\r\n    this.syncState();\r\n\r\n    wrapper.insertBefore(inputGroup, wrapper.firstChild);\r\n\r\n    wrapper.dispatchEvent(new Event('button-radio.loaded'));\r\n\r\n    // Make color elements unique\r\n    this.colors = [...new Set(this.colors)];\r\n  }\r\n\r\n  prepareButton(radio: HTMLInputElement, exists = false) {\r\n    const options = this.options;\r\n\r\n    const input = radio.querySelector('input')!;\r\n    const label = radio.querySelector('label')!;\r\n\r\n    let button: HTMLButtonElement;\r\n\r\n    if (exists) {\r\n      button = this.wrapper.querySelector(`[data-for=\"${input.id}\"]`)!;\r\n      button.classList.add(...this.parseClasses(`${options.buttonClass} ${options.color['default']}`));\r\n    } else {\r\n      button = h(\r\n        'button',\r\n        {\r\n          type: 'button',\r\n          class: `${options.buttonClass} ${options.color['default']}`,\r\n          'data-value': input.value,\r\n        },\r\n        `<span>${label.innerHTML}</span>`\r\n      );\r\n    }\r\n\r\n    data(button, 'input', input);\r\n    this.inputs.push(input);\r\n    this.buttons.push(button);\r\n\r\n    radio.style.display = 'none';\r\n\r\n    // Prepare color schema\r\n    let color = input.dataset.colorClass || '';\r\n\r\n    if (!color) {\r\n      switch (input.value) {\r\n        case '':\r\n          color = options.color.blue || '';\r\n          break;\r\n\r\n        case '0':\r\n          color = options.color.red || '';\r\n          break;\r\n\r\n        default:\r\n          color = options.color.green || '';\r\n          break;\r\n      }\r\n\r\n      input.dataset.colorClass = color;\r\n    }\r\n    \r\n    this.colors.push(color);\r\n\r\n    if (input.disabled || input.getAttribute('readonly') != null) {\r\n      button.classList.add('disabled');\r\n      button.disabled = true;\r\n    }\r\n\r\n    if (input.getAttribute('readonly') != null) {\r\n      button.classList.add('readonly');\r\n    }\r\n\r\n    // Bind event\r\n    button.addEventListener('click', () => {\r\n      if (input.getAttribute('disabled') || input.getAttribute('readonly')) {\r\n        return;\r\n      }\r\n\r\n      const changed = !input.checked;\r\n\r\n      if (changed) {\r\n        this.inputs.forEach((ele) => {\r\n          ele.checked = false;\r\n        });\r\n\r\n        input.checked = true;\r\n\r\n        input.dispatchEvent(new Event('change'));\r\n        input.dispatchEvent(new Event('input'));\r\n      }\r\n    });\r\n\r\n    input.addEventListener('change', () => {\r\n      this.syncState();\r\n    });\r\n\r\n    return button;\r\n  }\r\n\r\n  syncState() {\r\n    const options = this.options;\r\n\r\n    this.buttons.forEach((button) => {\r\n      const input: HTMLInputElement = data(button, 'input');\r\n\r\n      button.classList.add(...this.parseClasses(options.color.default || ''));\r\n      button.classList.remove(...this.parseClasses(options.activeClass));\r\n      button.classList.remove(...this.parseClasses(...this.colors));\r\n\r\n      if (input.checked) {\r\n        button.classList.add(...this.parseClasses(options.activeClass));\r\n        button.classList.add(...this.parseClasses(input.dataset.colorClass || ''));\r\n        button.classList.remove(...this.parseClasses(options.color.default || ''));\r\n      }\r\n    });\r\n  }\r\n\r\n  parseClasses(...className: string[]) {\r\n    const classNameStr = className.join(' ');\r\n    return classNameStr.split(' ').filter(t => t !== '');\r\n  }\r\n}\r\n\r\nexport const ready = useUniDirective('button-radio', {\r\n  mounted(el, { value }) {\r\n    const options: ButtonRadioOptions = JSON.parse(value || '{}');\r\n    ButtonRadio.handle(el, value || {});\r\n  }\r\n});\r\n\r\nexport interface ButtonRadioModule {\r\n  ButtonRadio: typeof ButtonRadio;\r\n  ready: typeof ready;\r\n}\r\n"],"names":["el"],"mappings":"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"}