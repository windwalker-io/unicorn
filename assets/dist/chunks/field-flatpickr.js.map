{"version":3,"file":"field-flatpickr.js","sources":["../../src/module/field-flatpickr.ts"],"sourcesContent":["import { useCssImport, useImport, injectCssToDocument } from '../service';\r\nimport flatpickr from 'flatpickr';\r\nimport css from 'flatpickr/dist/flatpickr.css?inline';\r\n\r\ninjectCssToDocument(css);\r\n\r\nclass FlatpickrElement extends HTMLElement {\r\n  static get is() {\r\n    return 'uni-flatpickr';\r\n  }\r\n\r\n  instance!: flatpickr.Instance;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  get selector() {\r\n    return this.getAttribute('selector') || 'input';\r\n  }\r\n\r\n  get locale() {\r\n    return this.getAttribute('locale') || '';\r\n  }\r\n\r\n  // todo: Currently not support single option attributes\r\n  getOptions() {\r\n    const options: any = {};\r\n    const ignore = [\r\n      'selector'\r\n    ];\r\n\r\n    this.getAttributeNames().forEach((name) => {\r\n      if (ignore.indexOf(name) !== -1) {\r\n        return;\r\n      }\r\n\r\n      options[name] = this.getAttribute(name);\r\n    });\r\n\r\n    return options;\r\n  }\r\n\r\n  get $input(): HTMLInputElement {\r\n    return this.querySelector<HTMLInputElement>('input')!;\r\n  }\r\n\r\n  async connectedCallback() {\r\n    let options: flatpickr.Options.Options = JSON.parse(this.getAttribute('options') || '{}') || {};\r\n\r\n    options.autoFillDefaultTime = true;\r\n    const now = new Date();\r\n    options.defaultHour = now.getHours();\r\n    options.defaultMinute = now.getMinutes();\r\n    options.defaultSeconds = now.getSeconds();\r\n\r\n    options = await this.handleOptions(options);\r\n\r\n    this.instance = flatpickr(\r\n      this.querySelector<HTMLElement>(this.selector)!,\r\n      options\r\n    );\r\n\r\n    // If no value, set default time on open\r\n    this.instance.config.onOpen.push(() => {\r\n      if (this.instance.input.value === '') {\r\n        const now = new Date();\r\n        this.instance.jumpToDate(now);\r\n        this.instance.config.defaultHour = now.getHours();\r\n        this.instance.config.defaultMinute = now.getMinutes();\r\n        this.instance.config.defaultSeconds = now.getSeconds();\r\n      }\r\n    });\r\n\r\n    this.querySelector('[data-toggle]')?.addEventListener('click', () => {\r\n      setTimeout(() => {\r\n        this.querySelector<HTMLInputElement>('[data-input]')?.focus();\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  async handleOptions(options: flatpickr.Options.Options): Promise<flatpickr.Options.Options> {\r\n    options.plugins = options.plugins || [];\r\n\r\n    await Promise.all([\r\n      this.handleLocale(options),\r\n      this.handleMonthSelect(options)\r\n    ]);\r\n\r\n    return options;\r\n  }\r\n\r\n  private async handleLocale(options: Record<string, any>) {\r\n    if (this.locale) {\r\n      await useImport(`flatpickr/dist/l10n/${this.locale}.js`);\r\n\r\n      options.locale = this.locale.replace(/-/, '_');\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  private async handleMonthSelect(options: Record<string, any>) {\r\n    if (options.monthSelect) {\r\n      useCssImport('flatpickr/dist/plugins/monthSelect/style.css');\r\n      const { default: monthSelect } = await import('flatpickr/dist/plugins/monthSelect');\r\n\r\n      if (typeof options.monthSelect === 'boolean') {\r\n        options.monthSelect = {\r\n          shorthand: true,\r\n          dateFormat: 'Y-m',\r\n          altFormat: 'Y-m'\r\n        };\r\n      }\r\n\r\n      options.plugins.push(monthSelect(options.monthSelect));\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  getInstance() {\r\n    return this.instance;\r\n  }\r\n}\r\n\r\ncustomElements.define(FlatpickrElement.is, FlatpickrElement);\r\n"],"names":["now"],"mappings":"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"}